"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[170],{42170:(e,n,t)=>{t.r(n),t.d(n,{createReferencedImageDisplaySet:()=>ee,default:()=>ae,hydrateStructuredReport:()=>J.Z,srProtocol:()=>B});var r=t(43001);const a=JSON.parse('{"u2":"@ohif/extension-cornerstone-dicom-sr"}').u2,o="dicom-sr",i=`${a}.sopClassHandlerModule.${o}`;var s=t(20599),u=t(45451),c=t(91092),l=t(10740),d=t(64035);const f={POINT:"POINT",MULTIPOINT:"MULTIPOINT",POLYLINE:"POLYLINE",CIRCLE:"CIRCLE",ELLIPSE:"ELLIPSE"};class g extends c.AnnotationTool{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{configuration:{}}),this.isPointNearTool=()=>null,this.getHandleNearImagePoint=()=>null,this.renderAnnotation=(e,n)=>{const{viewport:t}=e,{element:r}=t;let a=c.annotation.state.getAnnotations(this.getToolName(),r);if(!a?.length)return;if(a=this.filterInteractableAnnotationsForElement(r,a),!a?.length)return;const o=(0,d.yR)(r),{activeIndex:i,trackingUniqueIdentifiers:s}=o,u=s[i],l=a.filter((e=>s.includes(e.data?.cachedStats?.TrackingUniqueIdentifier)));if(!t._actors?.size)return;const g={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<l.length;e++){const r=l[e],a=r.annotationUID,{renderableData:o}=r.data.cachedStats,{cachedStats:i}=r.data,{referencedImageId:s}=r.metadata;g.annotationUID=a;const d=this.getStyle("lineWidth",g,r),p=this.getStyle("lineDash",g,r),h={color:i.TrackingUniqueIdentifier===u?"rgb(0, 255, 0)":this.getStyle("color",g,r),lineDash:p,lineWidth:d};Object.keys(o).forEach((e=>{const i=o[e];let u,l;switch(e){case f.POINT:u=this.renderPoint;break;case f.MULTIPOINT:u=this.renderMultipoint;break;case f.POLYLINE:u=this.renderPolyLine;break;case f.CIRCLE:u=this.renderEllipse;break;case f.ELLIPSE:u=this.renderEllipse,l=c.utilities.math.ellipse.getCanvasEllipseCorners;break;default:throw new Error(`Unsupported GraphicType: ${e}`)}const d=u(n,t,i,a,s,h);this.renderTextBox(n,t,d,l,r,g,h)}))}}}_getTextBoxLinesFromLabels(e){const n=Math.min(e.length,3),t=[];for(let r=0;r<n;r++){const n=e[r];t.push(`${h(n.label)}${n.value}`)}return t}renderPolyLine(e,n,t,r,a,o){const i={color:o.color,width:o.lineWidth};let s=[];return t.map(((t,a)=>{const o=t.map((e=>n.worldToCanvas(e))),u=`${a}`;2===o.length?c.drawing.drawLine(e,r,u,o[0],o[1],i):c.drawing.drawPolyline(e,r,u,o,i),s=s.concat(o)})),s}renderMultipoint(e,n,t,r,a,o){let i;t.map(((t,a)=>{i=t.map((e=>n.worldToCanvas(e)));c.drawing.drawHandles(e,r,"0",i,{color:o.color})}))}renderPoint(e,n,t,r,a,o){const i=[];return t.map(((t,s)=>{const u=t[0];i.push(n.worldToCanvas(u));const d=l.metaData.get("imagePixelModule",a);let f=10,g=10;if(d){const{columns:e,rows:n}=d;f=e/10,g=n/10}const p=l.utilities.worldToImageCoords(a,u),h=l.utilities.imageToWorldCoords(a,[p[0]+f,p[1]+g]);i.push(n.worldToCanvas(h));const m=`${s}`;c.drawing.drawArrow(e,r,m,i[1],i[0],{color:o.color,width:o.lineWidth})})),i}renderEllipse(e,n,t,r,a,o){let i;return t.map(((t,a)=>{if(0===t.length)return;const s=t,u=n.getRotation();let l;i=s.map((e=>n.worldToCanvas(e))),l=90==u||270==u?c.utilities.math.ellipse.getCanvasEllipseCorners([i[2],i[3],i[0],i[1]]):c.utilities.math.ellipse.getCanvasEllipseCorners(i);const d=`${a}`;c.drawing.drawEllipse(e,r,d,l[0],l[1],{color:o.color,width:o.lineWidth})})),i}renderTextBox(e,n,t,r,a,o){let i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};if(!t||!a)return;const{annotationUID:s,data:u={}}=a,{label:l}=u,{color:d}=i;let f=t;"function"==typeof r&&(f=r(t));const g=this._getTextBoxLinesFromLabels(l),p=c.utilities.drawing.getTextBoxCoordsCanvas(f);a.data.handles.textBox.worldPosition=n.canvasToWorld(p);const h=n.worldToCanvas(a.data.handles.textBox.worldPosition),m=this.getLinkedTextBoxStyle(o,a),S=c.drawing.drawLinkedTextBox(e,s,"1",g,h,t,{},{...m,color:d}),{x:I,y:v,width:y,height:T}=S;a.data.handles.textBox.worldBoundingBox={topLeft:n.canvasToWorld([I,v]),topRight:n.canvasToWorld([I+y,v]),bottomLeft:n.canvasToWorld([I,v+T]),bottomRight:n.canvasToWorld([I+y,v+T])}}}g.toolName="DICOMSRDisplay";const p={"Short Axis":"W: ","Long Axis":"L: ",AREA:"Area: ",Length:"",CORNERSTONEFREETEXT:""};function h(e){const n=p[e];return void 0!==n?n:e}const m={DICOMSRDisplay:g.toolName,SRLength:"SRLength",SRBidirectional:"SRBidirectional",SREllipticalROI:"SREllipticalROI",SRCircleROI:"SRCircleROI",SRArrowAnnotate:"SRArrowAnnotate",SRAngle:"SRAngle",SRCobbAngle:"SRCobbAngle",SRRectangleROI:"SRRectangleROI",SRPlanarFreehandROI:"SRPlanarFreehandROI"},S=1e-4;function I(e,n,t){const r=m.DICOMSRDisplay,a={TrackingUniqueIdentifier:e.TrackingUniqueIdentifier,renderableData:{},labels:e.labels,imageId:n};e.coords.forEach((t=>{const{GraphicType:r,GraphicData:o}=t;void 0===a.renderableData[r]&&(a.renderableData[r]=[]),a.renderableData[r].push(function(e,n,t,r){const[a,o]=r.split(":");let i;switch(e){case f.POINT:case f.MULTIPOINT:case f.POLYLINE:i=[];for(let e=0;e<n.length;e+=2){const r=l.utilities.imageToWorldCoords(t,[n[e],n[e+1]]);i.push(r)}break;case f.CIRCLE:{const e=[];for(let r=0;r<n.length;r+=2){const a=l.utilities.imageToWorldCoords(t,[n[r],n[r+1]]);e.push(a)}const r=e[0],a=e[1],o=u.R3.distance(r,a),s=l.metaData.get("imagePlaneModule",t);if(!s)throw new Error("No imagePlaneModule found");const{columnCosines:c,rowCosines:d}=s,f=u.R3.create();u.R3.scaleAndAdd(f,r,c,o);const g=u.R3.create();u.R3.scaleAndAdd(g,r,c,-o);const p=u.R3.create();u.R3.scaleAndAdd(p,r,d,o);const h=u.R3.create();u.R3.scaleAndAdd(h,r,d,-o),i=[f,g,p,h];break}case f.ELLIPSE:{const e=[];for(let r=0;r<n.length;r+=2){const a=l.utilities.imageToWorldCoords(t,[n[r],n[r+1]]);e.push(a)}const r=u.R3.fromValues(...e[0]),a=u.R3.fromValues(...e[1]),o=u.R3.fromValues(...e[2]),s=u.R3.fromValues(...e[3]),c=u.R3.create();u.R3.sub(c,a,r),u.R3.normalize(c,c);const d=u.R3.create();u.R3.sub(d,s,o),u.R3.normalize(d,d);const f=l.metaData.get("imagePlaneModule",t);if(!f)throw new Error("imageId does not have imagePlaneModule metadata");const{columnCosines:g}=f,p=u.R3.fromValues(...g),h=Math.abs(u.R3.dot(p,c)),m=Math.abs(u.R3.dot(p,d)),I=Math.abs(h),v=Math.abs(m);i=[],Math.abs(I-1)<S?i=[e[0],e[1],e[2],e[3]]:Math.abs(v-1)<S?i=[e[2],e[3],e[0],e[1]]:console.warn("OBLIQUE ELLIPSE NOT YET SUPPORTED");break}default:console.warn("Unsupported GraphicType:",e)}return i}(r,o,n,e.TrackingIdentifier))}));const o=l.metaData.get("imagePlaneModule",n),i=c.annotation.state.getAnnotationManager(),s=e.coords[0].ReferencedSOPSequence&&e.coords[0].ReferencedSOPSequence[0]?.ReferencedFrameNumber||1,d={annotationUID:e.TrackingUniqueIdentifier,metadata:{FrameOfReferenceUID:o.frameOfReferenceUID,toolName:r,referencedImageId:n},data:{label:e.labels,handles:{textBox:{}},cachedStats:{TrackingUniqueIdentifier:a.TrackingUniqueIdentifier,renderableData:a.renderableData},frameNumber:s}};i.addAnnotation(d),e.loaded=!0,e.imageId=n,e.displaySetInstanceUID=t,e.ReferencedSOPInstanceUID=e.coords[0].ReferencedSOPSequence.ReferencedSOPInstanceUID,e.frameNumber=s,delete e.coords}var v=t(6154);const y=v.adaptersSR.Cornerstone3D.MeasurementReport.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE,T=["cornerstoneTools@^4.0.0"],C=y.CORNERSTONE_3D_TAG;const{CodeScheme:R}=v.adaptersSR.Cornerstone3D,{ImageSet:D,MetadataProvider:O}=s.classes,E=["1.2.840.10008.5.1.4.1.1.88.11","1.2.840.10008.5.1.4.1.1.88.22","1.2.840.10008.5.1.4.1.1.88.33","1.2.840.10008.5.1.4.1.1.88.34"],b="Cornerstone3DTools",w="0.1",x=(e,n)=>{n.forEach((n=>{if(n.StudyInstanceUID!==e)throw console.warn("Not all instances have the same UID",e,n),new Error(`Instances ${n.SOPInstanceUID} does not belong to ${e}`)}))},M={ImagingMeasurementReport:"126000",ImageLibrary:"111028",ImagingMeasurements:"126010",MeasurementGroup:"125007",ImageLibraryGroup:"126200",TrackingUniqueIdentifier:"112040",TrackingIdentifier:"112039",Finding:"121071",FindingSite:"G-C0E3",CornerstoneFreeText:R.codeValues.CORNERSTONEFREETEXT},N={SRT:"SRT",CornerstoneCodeSchemes:[R.CodingSchemeDesignator,"CST4"]},P={INFERRED_FROM:"INFERRED FROM",CONTAINS:"CONTAINS"},A="CORNERSTONEFREETEXT";function U(e,n){return this.instances.push(...e),s.utils.sortStudyInstances(this.instances),this.instance=this.instances[this.instances.length-1],this.isLoaded=!1,this}function q(e,n,t){if(!e||!e.length)throw new Error("No instances were provided");s.utils.sortStudyInstances(e);const r=e[e.length-1],{StudyInstanceUID:a,SeriesInstanceUID:o,SOPInstanceUID:u,SeriesDescription:c,SeriesNumber:l,SeriesDate:d,ConceptNameCodeSequence:f,SOPClassUID:g}=r;if(x(r.StudyInstanceUID,e),!f||f.CodeValue!==M.ImagingMeasurementReport)return n.services.uiNotificationService.show({title:"DICOM SR",message:"OHIF only supports TID1500 Imaging Measurement Report Structured Reports. The SR youâ€™re trying to view is not supported.",type:"warning",duration:6e3}),[];const p={Modality:"SR",displaySetInstanceUID:s.utils.guid(),SeriesDescription:c,SeriesNumber:l,SeriesDate:d,SOPInstanceUID:u,SeriesInstanceUID:o,StudyInstanceUID:a,SOPClassHandlerId:i,SOPClassUID:g,instances:e,referencedImages:null,measurements:null,isDerivedDisplaySet:!0,isLoaded:!1,sopClassUids:E,instance:r,addInstances:U};return p.load=()=>function(e,n,t){const{displaySetService:r,measurementService:a}=n.services,o=t.getDataSources(),i=o[0],{ContentSequence:s}=e.instance;e.referencedImages=function(e){const n=_(e.find((e=>e.ConceptNameCodeSequence.CodeValue===M.ImageLibrary)).ContentSequence).find((e=>e.ConceptNameCodeSequence.CodeValue===M.ImageLibraryGroup)),t=[];return _(n.ContentSequence).forEach((e=>{const{ReferencedSOPSequence:n}=e;if(n)for(const e of _(n))if(e.ReferencedSOPClassUID){const{ReferencedSOPClassUID:n,ReferencedSOPInstanceUID:r}=e;t.push({ReferencedSOPClassUID:n,ReferencedSOPInstanceUID:r})}})),t}(s),e.measurements=function(e){const n=e.find((e=>e.ConceptNameCodeSequence.CodeValue===M.ImagingMeasurements)),t=function(e){const n={};return e.forEach((e=>{const t=_(e.ContentSequence),r=t.find((e=>e.ConceptNameCodeSequence.CodeValue===M.TrackingUniqueIdentifier));r||console.warn("No Tracking Unique Identifier, skipping ambiguous measurement.");const a=r.UID;void 0===n[a]?n[a]=[...t]:t.forEach((e=>{e.ConceptNameCodeSequence.CodeValue!==M.TrackingUniqueIdentifier&&n[a].push(e)}))})),n}(_(n.ContentSequence).filter((e=>e.ConceptNameCodeSequence.CodeValue===M.MeasurementGroup))),r=[];return Object.keys(t).forEach((e=>{const n=function(e){if(e.some((e=>"SCOORD"===e.ValueType||"SCOORD3D"===e.ValueType)))return function(e){const n=e.find((e=>"SCOORD"===e.ValueType)),t=e.find((e=>"UIDREF"===e.ValueType)),r=e.find((e=>e.ConceptNameCodeSequence.CodeValue===M.TrackingIdentifier));if(!n)return void console.warn(`graphic ValueType ${n.ValueType} not currently supported, skipping annotation.`);const a=e.filter((e=>"NUM"===e.ValueType)),o={loaded:!1,labels:[],coords:[L(n)],TrackingUniqueIdentifier:t.UID,TrackingIdentifier:r.TextValue};return a.forEach((e=>{const{ConceptNameCodeSequence:n,MeasuredValueSequence:t}=e;t&&o.labels.push(F(n,t))})),o}(e);return function(e){const n=e.filter((e=>"NUM"===e.ValueType)),t=e.find((e=>"UIDREF"===e.ValueType)),r=e.find((e=>e.ConceptNameCodeSequence.CodeValue===M.TrackingIdentifier)),a=e.find((e=>e.ConceptNameCodeSequence.CodeValue===M.Finding)),o=e.filter((e=>e.ConceptNameCodeSequence.CodingSchemeDesignator===N.SRT&&e.ConceptNameCodeSequence.CodeValue===M.FindingSite)),i={loaded:!1,labels:[],coords:[],TrackingUniqueIdentifier:t.UID,TrackingIdentifier:r.TextValue};a&&N.CornerstoneCodeSchemes.includes(a.ConceptCodeSequence.CodingSchemeDesignator)&&a.ConceptCodeSequence.CodeValue===M.CornerstoneFreeText&&i.labels.push({label:A,value:a.ConceptCodeSequence.CodeMeaning});if(o.length){const e=o.find((e=>N.CornerstoneCodeSchemes.includes(e.ConceptCodeSequence.CodingSchemeDesignator)&&e.ConceptCodeSequence.CodeValue===M.CornerstoneFreeText));e&&i.labels.push({label:A,value:e.ConceptCodeSequence.CodeMeaning})}return n.forEach((e=>{const{ConceptNameCodeSequence:n,ContentSequence:t,MeasuredValueSequence:r}=e,{ValueType:a}=t;if("SCOORD"===!a)return void console.warn(`Graphic ${a} not currently supported, skipping annotation.`);const o=L(t);o&&i.coords.push(o),r&&i.labels.push(F(n,r))})),i}(e)}(t[e]);n&&r.push(n)})),r}(s);const u=a.getSourceMappings(b,w);e.isHydrated=!1,e.isRehydratable=function(e,n){if(!n||!n.length)return!1;const t=n.map((e=>e.annotationType)),{measurements:r}=e,a=Object.keys(y).filter((e=>"function"==typeof y[e].isValidCornerstoneTrackingIdentifier)),o=[];a.forEach((e=>{t.includes(e)&&o.push(y[e])}));for(let e=0;e<r.length;e++){const{TrackingIdentifier:n}=r[e]||{};if(o.some((e=>{let[t,r]=n.split(":");T.includes(t)&&(t=C);const a=`${t}:${r}`;return e.isValidCornerstoneTrackingIdentifier(a)})))return!0;console.log("Measurement is not rehydratable",n,r[e])}return console.log("No measurements found which were rehydratable"),!1}(e,u),e.isLoaded=!0,r.activeDisplaySets.forEach((n=>{V(e,n,i)})),r.subscribe(r.EVENTS.DISPLAY_SETS_ADDED,(n=>{const{displaySetsAdded:t}=n;t.forEach((n=>{V(e,n,i)}))}))}(p,n,t),[p]}function V(e,n,t){let r=e.measurements.filter((e=>!1===e.loaded));if(0===r.length)return;if(!n instanceof D)return;const{sopClassUids:a,images:o}=n;if(r=r.filter((e=>e.coords.some((e=>a.includes(e.ReferencedSOPSequence.ReferencedSOPClassUID))))),0===r.length)return;const i=[];r.forEach((e=>{const{coords:n}=e;n.forEach((e=>{const n=e.ReferencedSOPSequence.ReferencedSOPInstanceUID;i.includes(n)||i.push(n)}))}));const s=t.getImageIdsForDisplaySet(n);for(const e of s){if(!r.length)return;const{SOPInstanceUID:t,frameNumber:a}=O.getUIDsFromImageID(e);if(i.includes(t))for(let o=r.length-1;o>=0;o--){const i=r[o];k(i,t,a)&&(I(i,e,n.displaySetInstanceUID),r.splice(o,1))}}}function k(e,n,t){const{coords:r}=e,a=e.coords[0].ReferencedSOPSequence&&e.coords[0].ReferencedSOPSequence[0]?.ReferencedFrameNumber||1;if(t&&Number(t)!==Number(a))return!1;for(let e=0;e<r.length;e++){const t=r[e],{ReferencedSOPInstanceUID:a}=t.ReferencedSOPSequence;if(a===n)return!0}}function L(e){const{ValueType:n,RelationshipType:t,GraphicType:r,GraphicData:a}=e;if(t!=P.INFERRED_FROM&&t!=P.CONTAINS)return void console.warn(`Relationshiptype === ${t}. Cannot deal with NON TID-1400 SCOORD group with RelationshipType !== "INFERRED FROM" or "CONTAINS"`);const o={ValueType:n,GraphicType:r,GraphicData:a};if("SCOORD"===n){const{ReferencedSOPSequence:n}=e.ContentSequence;o.ReferencedSOPSequence=n}else if("SCOORD3D"===n){const{ReferencedFrameOfReferenceSequence:n}=e.ContentSequence;o.ReferencedFrameOfReferenceSequence=n}return o}function F(e,n){const{CodeMeaning:t}=e,{NumericValue:r,MeasurementUnitsCodeSequence:a}=n,{CodeValue:o}=a;return{label:t,value:`${r?Number(r).toFixed(2):""} ${o}`}}function _(e){return e?Array.isArray(e)?e:[e]:[]}const G=function(e){let{servicesManager:n,extensionManager:t}=e;return[{name:o,sopClassUids:E,getDisplaySetsFromSeries:e=>q(e,n,t)}]},B={id:"@ohif/sr",hasUpdatedPriorsInformation:!1,name:"SR Key Images",protocolMatchingRules:[],toolGroupIds:["default"],numberOfPriorsReferenced:0,defaultViewport:{viewportOptions:{viewportType:"stack",toolGroupId:"default",allowUnmatchedView:!0},displaySets:[{id:"srDisplaySetId",matchedDisplaySetsIndex:-1}]},displaySetSelectors:{srDisplaySetId:{seriesMatchingRules:[{attribute:"Modality",constraint:{equals:"SR"}}]}},stages:[{name:"SR Key Images",viewportStructure:{layoutType:"grid",properties:{rows:1,columns:1}},viewports:[{viewportOptions:{allowUnmatchedView:!0},displaySets:[{id:"srDisplaySetId"}]}]}]};var j=t(67540);const{log:Y}=s.default;const z=function(e,n){const t={};function r(r,a){if(!r.metadata?.referencedImageId)return void Y.warn(`[DICOMSR] No referencedImageId found for ${a} ${r.id}`);const o=r.metadata.referencedImageId;t[o]||(t[o]={});const i=t[o];i[a]||(i[a]={data:[]});const s=e.find((e=>e.uid===r.annotationUID)),u=i[a].data;let{finding:c}=s;const l=[];s.label&&(n.includes(a)?c={CodeValue:"CORNERSTONEFREETEXT",CodingSchemeDesignator:"CORNERSTONEJS",CodeMeaning:s.label}:l.push({CodeValue:"CORNERSTONEFREETEXT",CodingSchemeDesignator:"CORNERSTONEJS",CodeMeaning:s.label})),s.findingSites&&l.push(...s.findingSites);const d=Object.assign({},r,{finding:c,findingSites:l});u.push(d)}const a=e.map((e=>e.uid)).slice(),o=c.annotation.state.getAnnotationManager(),i=o.getFramesOfReference();for(let e=0;e<i.length;e++){const n=i[e],s=o.getAnnotations(n),u=Object.keys(s);for(let e=0;e<u.length;e++){const n=u[e],o=s[n];if(o)for(let e=0;e<o.length;e++){const i=o[e],s=a.findIndex((e=>e===i.annotationUID));if(-1!==s&&(r(i,n),a.splice(s,1),!a.length))return t}}}return t},{MeasurementReport:H}=v.adaptersSR.Cornerstone3D,{log:$}=s.default,W=e=>{let{}=e;const n={downloadReport:e=>{let{measurementData:t,additionalFindingTypes:r,options:a={}}=e;const o=n.generateReport(t,r,a),i=j.default.data.datasetToBlob(o);var s=URL.createObjectURL(i);window.location.assign(s)},storeMeasurements:async e=>{let{measurementData:n,dataSource:t,additionalFindingTypes:r,options:a={}}=e;if($.info("[DICOMSR] storeMeasurements"),!t||!t.store||!t.store.dicom)return $.error("[DICOMSR] datasource has no dataSource.store.dicom endpoint!"),Promise.reject({});try{const e=function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=z(e,n),a=H.generateReport(r,l.metaData,l.utilities.worldToImageCoords,t),{dataset:o}=a;return void 0===o.SpecificCharacterSet&&(o.SpecificCharacterSet="ISO_IR 192"),o}(n,r,a),{StudyInstanceUID:o,ContentSequence:i}=e;if(!i?.[4].ContentSequence?.length)throw console.log("naturalizedReport missing imaging content",e),new Error("Invalid report, no content");return await t.store.dicom(e),o&&t.deleteStudyMetadataPromise(o),s.DicomMetadataStore.addInstances([e],!0),e}catch(e){throw console.warn(e),$.error(`[DICOMSR] Error while saving the measurements: ${e.message}`),new Error(e.message||"Error while saving the measurements.")}}},t={downloadReport:{commandFn:n.downloadReport,storeContexts:[],options:{}},storeMeasurements:{commandFn:n.storeMeasurements,storeContexts:[],options:{}}};return{actions:n,definitions:t,defaultContext:"CORNERSTONE_STRUCTURED_REPORT"}};function X(e,n,t){class r extends n{}r.toolName=e,(0,c.addTool)(r)}var J=t(38965);const K=s.classes.ImageSet,Q=(e,n)=>{const{displaySetInstanceUID:t,ReferencedSOPInstanceUID:r}=e,a=n.getDisplaySetByUID(t);if(a.images)return a.images.find((e=>e.SOPInstanceUID===r))},Z=(e,n)=>{const t=[],r={};for(const a of n.measurements){const{imageId:n}=a;if(!n)continue;if(r[n])continue;const o=Q(a,e);o?(r[n]=o,t.push(o)):console.log("Measurement",a,"had no instances found")}return t},ee=(e,n)=>{const t=Z(e,n),r=new K(t),a=t[0];return r.setAttributes({displaySetInstanceUID:r.uid,SeriesDate:a.SeriesDate,SeriesTime:a.SeriesTime,SeriesInstanceUID:r.uid,StudyInstanceUID:a.StudyInstanceUID,SeriesNumber:a.SeriesNumber||0,SOPClassUID:a.SOPClassUID,SeriesDescription:`${n.SeriesDescription} KO ${n.instance.SeriesNumber}`,Modality:"KO",isMultiFrame:!1,numImageFrames:t.length,SOPClassHandlerId:"@ohif/extension-default.sopClassHandlerModule.stack",isReconstructable:!1,isCompositeStack:!0,madeInClient:!0,excludeFromThumbnailBrowser:!0,updateInstances:function(){this.images.splice(0,this.images.length,...Z(e,n)),this.numImageFrames=this.images.length}}),e.addDisplaySets(r),r};function ne(){return ne=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},ne.apply(this,arguments)}const te=r.lazy((()=>t.e(886).then(t.bind(t,48886)))),re=e=>r.createElement(r.Suspense,{fallback:r.createElement("div",null,"Loading...")},r.createElement(te,e)),ae={id:a,onModeEnter:function(e){let{servicesManager:n}=e;const{displaySetService:t}=n.services;[...t.getDisplaySetCache().values()].filter((e=>e.SOPClassHandlerId===i)).forEach((e=>{e.isHydrated=!1}))},preRegistration:function(e){let{configuration:n={}}=e;(0,c.addTool)(g),X(m.SRLength,c.LengthTool),X(m.SRBidirectional,c.BidirectionalTool),X(m.SREllipticalROI,c.EllipticalROITool),X(m.SRCircleROI,c.CircleROITool),X(m.SRArrowAnnotate,c.ArrowAnnotateTool),X(m.SRAngle,c.AngleTool),X(m.SRCobbAngle,c.CobbAngleTool),X(m.SRPlanarFreehandROI,c.PlanarFreehandROITool);const t={lineDash:"4,4"};c.annotation.config.style.setToolGroupToolStyles("SRToolGroup",{SRLength:t,SRBidirectional:t,SREllipticalROI:t,SRCircleROI:t,SRArrowAnnotate:t,SRCobbAngle:t,SRAngle:t,SRPlanarFreehandROI:t,global:{}})},getViewportModule(e){let{servicesManager:n,extensionManager:t}=e;return[{name:"dicom-sr",component:e=>r.createElement(re,ne({servicesManager:n,extensionManager:t},e))}]},getCommandsModule:W,getSopClassHandlerModule:G,getUtilityModule(e){let{servicesManager:n}=e;return[{name:"tools",exports:{toolNames:m}}]}}},64035:(e,n,t)=>{t.d(n,{l2:()=>o,yR:()=>i});var r=t(10740);const a={TrackingUniqueIdentifier:null,trackingIdentifiersByViewportId:{}};function o(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o=(0,r.getEnabledElement)(e),{viewport:i}=o;a.trackingIdentifiersByViewportId[i.id]={trackingUniqueIdentifiers:n,activeIndex:t}}function i(e){const n=(0,r.getEnabledElement)(e),{viewport:t}=n;return a.trackingIdentifiersByViewportId[t.id]?a.trackingIdentifiersByViewportId[t.id]:{trackingUniqueIdentifiers:[]}}},38965:(e,n,t)=>{t.d(n,{Z:()=>p});var r=t(10740),a=t(20599);var o=t(6154);const{guid:i}=a.default.utils,{MeasurementReport:s,CORNERSTONE_3D_TAG:u}=o.adaptersSR.Cornerstone3D,c="Cornerstone3DTools",l="0.1",d=["cornerstoneTools@^4.0.0"],f=(e,n)=>{if(!n||"CORNERSTONEJS"===n.CodingSchemeDesignator)return;const t=`${n.CodingSchemeDesignator}:${n.CodeValue}`;return{...e[t],ref:t,...n,text:n.CodeMeaning}},g=(e,n)=>{if(!n||!n.length)return;const t=[];for(let r=0;r<n.length;r++){const a=f(e,n[r][0]||n[r]);a&&t.push(a)}return t.length&&t||void 0};function p(e,n){let{servicesManager:t,extensionManager:o}=e;const p=o.getActiveDataSource()[0],{measurementService:S,displaySetService:I,customizationService:v}=t.services,y=v.getCustomization("codingValues",{}),T=I.getDisplaySetByUID(n),C=S.getSourceMappings(c,l);if(!C||!C.length)throw new Error("Attempting to hydrate measurements service when no mappings present. This shouldn't be reached.");const R=a.DicomMetadataStore.getInstance(T.StudyInstanceUID,T.SeriesInstanceUID,T.SOPInstanceUID),D={},O={};T.measurements.forEach((e=>{const{ReferencedSOPInstanceUID:n,imageId:t,frameNumber:r}=e;D[n]||(D[n]=t,O[n]=[]),O[n][r]||(O[n][r]=t)}));const E=function(e){const n="Imaging Measurements",t="Measurement Group",r="Tracking Identifier",a=h(e.ContentSequence).find(m(n)),o=h(a.ContentSequence).filter(m(t)),i={},c=s.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE,l=[];return Object.keys(c).forEach((e=>{l.push(c[e]),i[e]=[]})),o.forEach(((e,n)=>{const t=h(e.ContentSequence).find((e=>e.ConceptNameCodeSequence.CodeMeaning===r)),a=t.TextValue;let[o,i]=a.split(":");d.includes(o)&&(o=u);const s=`${o}:${i}`;t.TextValue=s})),e}(R),b=s.generateToolState(E,D,r.utilities.imageToWorldCoords,r.metaData),w=C.map((e=>e.annotationType)),x={};Object.keys(b).forEach((e=>{w.includes(e)&&(x[e]=b[e])}));const M=[];let N;Object.keys(x).forEach((e=>{x[e].forEach((e=>{const n=e.annotation.data&&e.annotation.data.frameNumber||1,t=O[e.sopInstanceUid][n]||D[e.sopInstanceUid];M.includes(t)||M.push(t)}))}));const P=[];for(let e=0;e<M.length;e++){const n=M[e],{SeriesInstanceUID:t,StudyInstanceUID:a}=r.metaData.get("instance",n);P.includes(t)||P.push(t),N?N!==a&&console.warn("NO SUPPORT FOR SRs THAT HAVE MEASUREMENTS FROM MULTIPLE STUDIES."):N=a}return Object.keys(x).forEach((e=>{x[e].forEach((n=>{const t=n.annotation.data&&n.annotation.data.frameNumber||1,a=O[n.sopInstanceUid][t]||D[n.sopInstanceUid];n.uid=i();const o=r.metaData.get("instance",a),{FrameOfReferenceUID:s}=o,u={annotationUID:n.annotation.annotationUID,data:n.annotation.data,metadata:{toolName:e,referencedImageId:a,FrameOfReferenceUID:s}},d=S.getSource(c,l);u.data.label=function(e){const{findingSites:n=[],finding:t}=e;let r=n.find((e=>"CORNERSTONEFREETEXT"===e.CodeValue));return r?r.CodeMeaning:t&&"CORNERSTONEFREETEXT"===t.CodeValue?t.CodeMeaning:void 0}(n),u.data.finding=f(y,n.finding?.[0]),u.data.findingSites=g(y,n.findingSites),u.data.site=u.data.findingSites?.[0];const h=C.find((n=>n.annotationType===e));S.addRawMeasurement(d,e,{annotation:u},h.toMeasurementSchema,p),M.includes(a)||M.push(a)}))})),T.isHydrated=!0,{StudyInstanceUID:N,SeriesInstanceUIDs:P}}const h=function(e){return Array.isArray(e)?e:[e]},m=e=>n=>n.ConceptNameCodeSequence.CodeMeaning===e},6154:(e,n,t)=>{t.d(n,{adaptersSR:()=>yt});var r=t(67540),a=t(87513),o=t.n(a),i=t(11677),s=t.n(i),u=t(58955),c=t(45451);function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function d(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){S(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function f(){f=function(){return e};var e={},n=Object.prototype,t=n.hasOwnProperty,r=Object.defineProperty||function(e,n,t){e[n]=t.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function u(e,n,t){return Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[n]}try{u({},"")}catch(e){u=function(e,n,t){return e[n]=t}}function c(e,n,t,a){var o=n&&n.prototype instanceof g?n:g,i=Object.create(o.prototype),s=new E(a||[]);return r(i,"_invoke",{value:C(e,t,s)}),i}function l(e,n,t){try{return{type:"normal",arg:e.call(n,t)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var d={};function g(){}function p(){}function h(){}var m={};u(m,o,(function(){return this}));var S=Object.getPrototypeOf,I=S&&S(S(b([])));I&&I!==n&&t.call(I,o)&&(m=I);var v=h.prototype=g.prototype=Object.create(m);function y(e){["next","throw","return"].forEach((function(n){u(e,n,(function(e){return this._invoke(n,e)}))}))}function T(e,n){function a(r,o,i,s){var u=l(e[r],e,o);if("throw"!==u.type){var c=u.arg,d=c.value;return d&&"object"==typeof d&&t.call(d,"__await")?n.resolve(d.__await).then((function(e){a("next",e,i,s)}),(function(e){a("throw",e,i,s)})):n.resolve(d).then((function(e){c.value=e,i(c)}),(function(e){return a("throw",e,i,s)}))}s(u.arg)}var o;r(this,"_invoke",{value:function(e,t){function r(){return new n((function(n,r){a(e,t,n,r)}))}return o=o?o.then(r,r):r()}})}function C(e,n,t){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return w()}for(t.method=a,t.arg=o;;){var i=t.delegate;if(i){var s=R(i,t);if(s){if(s===d)continue;return s}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if("suspendedStart"===r)throw r="completed",t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);r="executing";var u=l(e,n,t);if("normal"===u.type){if(r=t.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:t.done}}"throw"===u.type&&(r="completed",t.method="throw",t.arg=u.arg)}}}function R(e,n){var t=n.method,r=e.iterator[t];if(void 0===r)return n.delegate=null,"throw"===t&&e.iterator.return&&(n.method="return",n.arg=void 0,R(e,n),"throw"===n.method)||"return"!==t&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+t+"' method")),d;var a=l(r,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,d;var o=a.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=void 0),n.delegate=null,d):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,d)}function D(e){var n={tryLoc:e[0]};1 in e&&(n.catchLoc=e[1]),2 in e&&(n.finallyLoc=e[2],n.afterLoc=e[3]),this.tryEntries.push(n)}function O(e){var n=e.completion||{};n.type="normal",delete n.arg,e.completion=n}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(D,this),this.reset(!0)}function b(e){if(e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function n(){for(;++r<e.length;)if(t.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=void 0,n.done=!0,n};return a.next=a}}return{next:w}}function w(){return{value:void 0,done:!0}}return p.prototype=h,r(v,"constructor",{value:h,configurable:!0}),r(h,"constructor",{value:p,configurable:!0}),p.displayName=u(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var n="function"==typeof e&&e.constructor;return!!n&&(n===p||"GeneratorFunction"===(n.displayName||n.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,u(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},y(T.prototype),u(T.prototype,i,(function(){return this})),e.AsyncIterator=T,e.async=function(n,t,r,a,o){void 0===o&&(o=Promise);var i=new T(c(n,t,r,a),o);return e.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},y(v),u(v,s,"Generator"),u(v,o,(function(){return this})),u(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var n=Object(e),t=[];for(var r in n)t.push(r);return t.reverse(),function e(){for(;t.length;){var r=t.pop();if(r in n)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=b,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var n in this)"t"===n.charAt(0)&&t.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(t,r){return i.type="throw",i.arg=e,n.next=t,r&&(n.method="next",n.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=t.call(o,"catchLoc"),u=t.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,n){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&t.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=n&&n<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=n,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(i)},complete:function(e,n){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&n&&(this.next=n),d},finish:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),O(t),d}},catch:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.tryLoc===e){var r=t.completion;if("throw"===r.type){var a=r.arg;O(t)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,t){return this.delegate={iterator:b(e),resultName:n,nextLoc:t},"next"===this.method&&(this.arg=void 0),d}},e}function g(e,n,t,r,a,o,i){try{var s=e[o](i),u=s.value}catch(e){return void t(e)}s.done?n(u):Promise.resolve(u).then(r,a)}function p(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function h(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,R(r.key),r)}}function m(e,n,t){return n&&h(e.prototype,n),t&&h(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function S(e,n,t){return(n=R(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function I(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,a,o,i,s=[],u=!0,c=!1;try{if(o=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;u=!1}else for(;!(u=(r=o.call(t)).done)&&(s.push(r.value),s.length!==n);u=!0);}catch(e){c=!0,a=e}finally{try{if(!u&&null!=t.return&&(i=t.return(),Object(i)!==i))return}finally{if(c)throw a}}return s}}(e,n)||y(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e){return function(e){if(Array.isArray(e))return T(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,n){if(e){if("string"==typeof e)return T(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?T(e,n):void 0}}function T(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function C(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=y(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw o}}}}function R(e){var n=function(e,n){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:String(n)}var D=function(e){return Array.isArray(e)?e:[e]},O=function(e){return function(n){return n.ConceptNameCodeSequence.CodeMeaning===e}},E=r.hC.TID1500,b=r.hC.addAccessors,w=r.U7.StructuredReport,x=r.oq.Normalizer,M=E.TID1500MeasurementReport,N=E.TID1501MeasurementGroup,P=r.aT.DicomMetaDictionary,A={CodingSchemeDesignator:"DCM",CodeValue:"121071"},U={CodingSchemeDesignator:"SCT",CodeValue:"363698007"},q={CodingSchemeDesignator:"SRT",CodeValue:"G-C0E3"},V=function(e,n,t){var r=e.ConceptNameCodeSequence;if(r){var a=r.CodingSchemeDesignator,o=r.CodeValue;return a==n.CodingSchemeDesignator&&o==n.CodeValue||t&&a==t.CodingSchemeDesignator&&o==t.CodeValue}};var k=function(){function e(){p(this,e)}return m(e,null,[{key:"getSetupMeasurementData",value:function(e){var n=e.ContentSequence,t=D(n),r=t.find((function(e){return V(e,A)})),a=t.filter((function(e){return V(e,U,q)}))||[],o=t.find((function(e){return"NUM"===e.ValueType})),i=D(o.ContentSequence).find((function(e){return"SCOORD"===e.ValueType})),s=i.ContentSequence.ReferencedSOPSequence,u=s.ReferencedSOPInstanceUID,c=s.ReferencedFrameNumber,l={sopInstanceUid:u,frameIndex:c||1,complete:!0,finding:r?b(r.ConceptCodeSequence):void 0,findingSites:a.map((function(e){return b(e.ConceptCodeSequence)}))};l.finding&&(l.description=l.finding.CodeMeaning);var d=l.findingSites&&l.findingSites[0];return d&&(l.location=d[0]&&d[0].CodeMeaning||d.CodeMeaning),{defaultState:l,findingGroup:r,findingSiteGroups:a,NUMGroup:o,SCOORDGroup:i,ReferencedSOPSequence:s,ReferencedSOPInstanceUID:u,ReferencedFrameNumber:c}}},{key:"generateReport",value:function(e,n,t){var r=[],a=Object.keys(e)[0];if(!a)throw new Error("No measurements provided.");var o=n.get("generalSeriesModule",a),i=o.studyInstanceUID,s=o.seriesInstanceUID;Object.keys(e).forEach((function(t){var a=n.get("sopCommonModule",t),o=n.get("frameNumber",t),i=e[t],s=Object.keys(i),u={ReferencedSOPClassUID:a.sopClassUID,ReferencedSOPInstanceUID:a.sopInstanceUID};x.isMultiframeSOPClassUID(a.sopClassUID)&&(u.ReferencedFrameNumber=o);var c=[];s.forEach((function(e){var n=function(e,n,t){var r=n[e],a=k.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE[e];if(r&&r.data&&r.data.length&&a){var o=r.data.map((function(e){return function(e,n,t,r){var a=r.getTID300RepresentationArguments(e);return a.ReferencedSOPSequence=t,new r.TID300Representation(a)}(e,0,t,a)}));return new N(o)}}(e,i,u);n&&c.push(n)})),r=r.concat(c)}));var u=new M({TID1501MeasurementGroups:r},t),c=new Uint8Array(2);c[1]=1;var l={StudyInstanceUID:i,SeriesInstanceUID:s},d={FileMetaInformationVersion:{Value:[c.buffer],vr:"OB"},TransferSyntaxUID:{Value:["1.2.840.10008.1.2.1"],vr:"UI"},ImplementationClassUID:{Value:[P.uid()],vr:"UI"},ImplementationVersionName:{Value:["dcmjs"],vr:"SH"}};l._meta=d,l._vrMap={PixelData:"OW"};var f=new w([l]),g=u.contentItem(l);return f.dataset=Object.assign(f.dataset,g),f.dataset._meta=d,f}},{key:"generateToolState",value:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("1500"!==n.ContentTemplateSequence.TemplateIdentifier)throw new Error("This package can currently only interpret DICOM SR TID 1500");var r=D(n.ContentSequence).find(O("Imaging Measurements")),a=D(r.ContentSequence).filter(O("Measurement Group")),o={},i=e.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE,s=[];return Object.keys(i).forEach((function(e){s.push(i[e]),o[e]=[]})),a.forEach((function(e){var r=D(e.ContentSequence).find((function(e){return"Tracking Identifier"===e.ConceptNameCodeSequence.CodeMeaning})).TextValue,a=t.getToolClass?t.getToolClass(e,n,s):s.find((function(e){return e.isValidCornerstoneTrackingIdentifier(r)}));if(a){var i=a.getMeasurementData(e);console.log("=== ".concat(a.toolType," ===")),console.log(i),o[a.toolType].push(i)}})),o}},{key:"registerTool",value:function(n){e.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE[n.utilityToolType]=n,e.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE[n.toolType]=n,e.MEASUREMENT_BY_TOOLTYPE[n.toolType]=n.utilityToolType}}]),e}();k.MEASUREMENT_BY_TOOLTYPE={},k.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE={},k.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE={};var L="cornerstoneTools@^4.0.0",F=r.hC.TID300.Length,_="Length",G=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(n){var t=k.getSetupMeasurementData(n),r=t.defaultState,a=t.NUMGroup,o=t.SCOORDGroup,i=d(d({},r),{},{length:a.MeasuredValueSequence.NumericValue,toolType:e.toolType,handles:{start:{},end:{},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}),s=I(o.GraphicData,4);return i.handles.start.x=s[0],i.handles.start.y=s[1],i.handles.end.x=s[2],i.handles.end.y=s[3],i}},{key:"getTID300RepresentationArguments",value:function(e){var n=e.handles,t=e.finding,r=e.findingSites;return{point1:n.start,point2:n.end,distance:e.length,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:Length",finding:t,findingSites:r||[]}}}]),e}();G.toolType=_,G.utilityToolType=_,G.TID300Representation=F,G.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var n=I(e.split(":"),2),t=n[0],r=n[1];return t===L&&r===_},k.registerTool(G);var B=r.hC.TID300.Polyline,j=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(n){for(var t=k.getSetupMeasurementData(n),r=t.defaultState,a=t.SCOORDGroup,o=t.NUMGroup,i=d(d({},r),{},{toolType:e.toolType,handles:{points:[],textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}},cachedStats:{area:o?o.MeasuredValueSequence.NumericValue:0},color:void 0,invalidated:!0}),s=a.GraphicData,u=0;u<s.length;u+=2)i.handles.points.push({x:s[u],y:s[u+1]});return i}},{key:"getTID300RepresentationArguments",value:function(e){var n=e.handles,t=e.finding,r=e.findingSites,a=e.cachedStats,o=void 0===a?{}:a,i=n.points,s=o.area,u=void 0===s?0:s,c=o.perimeter;return{points:i,area:u,perimeter:void 0===c?0:c,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:FreehandRoi",finding:t,findingSites:r||[]}}}]),e}();j.toolType="FreehandRoi",j.utilityToolType="FreehandRoi",j.TID300Representation=B,j.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var n=I(e.split(":"),2),t=n[0],r=n[1];return t===L&&r===j.toolType},k.registerTool(j);var Y=r.hC.TID300.Bidirectional,z="Bidirectional",H=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(n){var t=n.ContentSequence,r=D(t).find((function(e){return"121071"===e.ConceptNameCodeSequence.CodeValue})),a=D(t).filter((function(e){return"G-C0E3"===e.ConceptNameCodeSequence.CodeValue})),o=D(t).find((function(e){return"Long Axis"===e.ConceptNameCodeSequence.CodeMeaning})),i=D(o.ContentSequence).find((function(e){return"SCOORD"===e.ValueType})),s=D(t).find((function(e){return"Short Axis"===e.ConceptNameCodeSequence.CodeMeaning})),u=D(s.ContentSequence).find((function(e){return"SCOORD"===e.ValueType})),c=i.ContentSequence.ReferencedSOPSequence,l=c.ReferencedSOPInstanceUID,d=c.ReferencedFrameNumber,f=String(o.MeasuredValueSequence.NumericValue),g=String(s.MeasuredValueSequence.NumericValue),p=Math.max(i.GraphicData[0],i.GraphicData[2],u.GraphicData[0],u.GraphicData[2]),h=Math.max(i.GraphicData[1],i.GraphicData[3],u.GraphicData[1],u.GraphicData[3]);return{sopInstanceUid:l,frameIndex:d||1,toolType:e.toolType,active:!1,handles:{start:{x:i.GraphicData[0],y:i.GraphicData[1],drawnIndependently:!1,allowedOutsideImage:!1,active:!1,highlight:!1,index:0},end:{x:i.GraphicData[2],y:i.GraphicData[3],drawnIndependently:!1,allowedOutsideImage:!1,active:!1,highlight:!1,index:1},perpendicularStart:{x:u.GraphicData[0],y:u.GraphicData[1],drawnIndependently:!1,allowedOutsideImage:!1,active:!1,highlight:!1,index:2},perpendicularEnd:{x:u.GraphicData[2],y:u.GraphicData[3],drawnIndependently:!1,allowedOutsideImage:!1,active:!1,highlight:!1,index:3},textBox:{highlight:!1,hasMoved:!0,active:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0,x:p+10,y:h+10}},invalidated:!1,isCreating:!1,longestDiameter:f,shortestDiameter:g,toolName:"Bidirectional",visible:!0,finding:r?r.ConceptCodeSequence:void 0,findingSites:a.map((function(e){return e.ConceptCodeSequence}))}}},{key:"getTID300RepresentationArguments",value:function(e){var n=e.handles,t=n.start,r=n.end,a=n.perpendicularStart,o=n.perpendicularEnd,i=e.shortestDiameter;return{longAxis:{point1:t,point2:r},shortAxis:{point1:a,point2:o},longAxisLength:e.longestDiameter,shortAxisLength:i,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:Bidirectional",finding:e.finding,findingSites:e.findingSites||[]}}}]),e}();H.toolType=z,H.utilityToolType=z,H.TID300Representation=Y,H.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var n=I(e.split(":"),2),t=n[0],r=n[1];return t===L&&r===z},k.registerTool(H);var $=r.hC.TID300.Ellipse,W="EllipticalRoi",X=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(n){var t=k.getSetupMeasurementData(n),r=t.defaultState,a=t.NUMGroup,o=t.SCOORDGroup.GraphicData,i=[{x:o[0],y:o[1]},{x:o[2],y:o[3]}],s=[{x:o[4],y:o[5]},{x:o[6],y:o[7]}],u=Math.sqrt(Math.pow(s[0].x-s[1].x,2)+Math.pow(s[0].y-s[1].y,2)),c=(s[1].x-s[0].x)/u,l=(s[1].y-s[0].y)/u,f=u/2,g={x:i[0].x+c*f,y:i[0].y+l*f},p={x:i[1].x-c*f,y:i[1].y-l*f};return d(d({},r),{},{toolType:e.toolType,active:!1,cachedStats:{area:a?a.MeasuredValueSequence.NumericValue:0},handles:{end:{x:g.x,y:g.y,highlight:!1,active:!1},initialRotation:0,start:{x:p.x,y:p.y,highlight:!1,active:!1},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}},invalidated:!0,visible:!0})}},{key:"getTID300RepresentationArguments",value:function(e){var n=e.cachedStats,t=void 0===n?{}:n,r=e.handles,a=e.finding,o=e.findingSites,i=r.start,s=r.end,u=t.area,c=Math.abs(i.x-s.x)/2,l=Math.abs(i.y-s.y)/2,d=[],f={x:(i.x+s.x)/2,y:(i.y+s.y)/2};c>l?(d.push({x:f.x-c,y:f.y}),d.push({x:f.x+c,y:f.y}),d.push({x:f.x,y:f.y-l}),d.push({x:f.x,y:f.y+l})):(d.push({x:f.x,y:f.y-l}),d.push({x:f.x,y:f.y+l}),d.push({x:f.x-c,y:f.y}),d.push({x:f.x+c,y:f.y}));return{area:u,points:d,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:EllipticalRoi",finding:a,findingSites:o||[]}}}]),e}();X.toolType=W,X.utilityToolType=W,X.TID300Representation=$,X.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var n=I(e.split(":"),2),t=n[0],r=n[1];return t===L&&r===W},k.registerTool(X);var J=r.hC.TID300.Circle,K="CircleRoi",Q=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(n){var t=k.getSetupMeasurementData(n),r=t.defaultState,a=t.NUMGroup,o=t.SCOORDGroup.GraphicData,i={x:o[0],y:o[1]},s={x:o[2],y:o[3]};return d(d({},r),{},{toolType:e.toolType,active:!1,cachedStats:{area:a?a.MeasuredValueSequence.NumericValue:0,radius:0,perimeter:0},handles:{end:d(d({},s),{},{highlight:!1,active:!1}),initialRotation:0,start:d(d({},i),{},{highlight:!1,active:!1}),textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}},invalidated:!0,visible:!0})}},{key:"getTID300RepresentationArguments",value:function(e){var n=e.cachedStats,t=void 0===n?{}:n,r=e.handles,a=e.finding,o=e.findingSites,i=r.start,s=r.end,u=t.area,c=t.radius,l=2*Math.PI*c,d=[];d.push(i),d.push(s);return{area:u,perimeter:l,radius:c,points:d,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:CircleRoi",finding:a,findingSites:o||[]}}}]),e}();Q.toolType=K,Q.utilityToolType=K,Q.TID300Representation=J,Q.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var n=I(e.split(":"),2),t=n[0],r=n[1];return t===L&&r===K},k.registerTool(Q);var Z=r.hC.TID300.Point,ee="ArrowAnnotate",ne="CORNERSTONEFREETEXT",te=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(n){var t=k.getSetupMeasurementData(n),r=t.defaultState,a=t.SCOORDGroup,o=t.findingGroup.ConceptCodeSequence.CodeMeaning,i=a.GraphicData;return d(d({},r),{},{toolType:e.toolType,active:!1,handles:{start:{x:i[0],y:i[1],highlight:!0,active:!1},end:{x:4==i.length?i[2]:i[0]+20,y:4==i.length?i[3]:i[1]+20,highlight:!0,active:!1},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}},invalidated:!0,text:o,visible:!0})}},{key:"getTID300RepresentationArguments",value:function(e){var n=[e.handles.start,e.handles.end],t=e.finding,r={points:n,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:ArrowAnnotate",findingSites:e.findingSites||[]};return t&&t.CodeValue===ne||(t={CodeValue:ne,CodingSchemeDesignator:"CST4",CodeMeaning:e.text}),r.finding=t,r}}]),e}();te.toolType=ee,te.utilityToolType=ee,te.TID300Representation=Z,te.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var n=I(e.split(":"),2),t=n[0],r=n[1];return t===L&&r===ee},k.registerTool(te);var re=r.hC.TID300.CobbAngle,ae="CobbAngle",oe=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(n){var t=k.getSetupMeasurementData(n),r=t.defaultState,a=t.NUMGroup,o=t.SCOORDGroup,i=d(d({},r),{},{rAngle:a.MeasuredValueSequence.NumericValue,toolType:e.toolType,handles:{start:{},end:{},start2:{highlight:!0,drawnIndependently:!0},end2:{highlight:!0,drawnIndependently:!0},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}),s=I(o.GraphicData,8);return i.handles.start.x=s[0],i.handles.start.y=s[1],i.handles.end.x=s[2],i.handles.end.y=s[3],i.handles.start2.x=s[4],i.handles.start2.y=s[5],i.handles.end2.x=s[6],i.handles.end2.y=s[7],i}},{key:"getTID300RepresentationArguments",value:function(e){var n=e.handles,t=e.finding,r=e.findingSites;return{point1:n.start,point2:n.end,point3:n.start2,point4:n.end2,rAngle:e.rAngle,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:CobbAngle",finding:t,findingSites:r||[]}}}]),e}();oe.toolType=ae,oe.utilityToolType=ae,oe.TID300Representation=re,oe.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var n=I(e.split(":"),2),t=n[0],r=n[1];return t===L&&r===ae},k.registerTool(oe);var ie=r.hC.TID300.Angle,se="Angle",ue=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(n){var t=k.getSetupMeasurementData(n),r=t.defaultState,a=t.NUMGroup,o=t.SCOORDGroup,i=d(d({},r),{},{rAngle:a.MeasuredValueSequence.NumericValue,toolType:e.toolType,handles:{start:{},middle:{},end:{},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}),s=I(o.GraphicData,8);return i.handles.start.x=s[0],i.handles.start.y=s[1],i.handles.middle.x=s[2],i.handles.middle.y=s[3],i.handles.middle.x=s[4],i.handles.middle.y=s[5],i.handles.end.x=s[6],i.handles.end.y=s[7],i}},{key:"getTID300RepresentationArguments",value:function(e){var n=e.handles,t=e.finding,r=e.findingSites;return{point1:n.start,point2:n.middle,point3:n.middle,point4:n.end,rAngle:e.rAngle,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:Angle",finding:t,findingSites:r||[]}}}]),e}();ue.toolType=se,ue.utilityToolType=se,ue.TID300Representation=ie,ue.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var n=I(e.split(":"),2),t=n[0],r=n[1];return t===L&&r===se},k.registerTool(ue);var ce=r.hC.TID300.Polyline,le=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(n){var t=k.getSetupMeasurementData(n),r=t.defaultState,a=t.SCOORDGroup,o=t.NUMGroup,i=d(d({},r),{},{toolType:e.toolType,handles:{start:{},end:{},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0},initialRotation:0},cachedStats:{area:o?o.MeasuredValueSequence.NumericValue:0},color:void 0,invalidated:!0}),s=I(a.GraphicData,6);return i.handles.start.x=s[0],i.handles.start.y=s[1],s[2],s[3],i.handles.end.x=s[4],i.handles.end.y=s[5],i}},{key:"getTID300RepresentationArguments",value:function(e){var n=e.finding,t=e.findingSites,r=e.cachedStats,a=void 0===r?{}:r,o=e.handles,i=o.start,s=o.end;return{points:[i,{x:i.x,y:s.y},s,{x:s.x,y:i.y}],area:a.area,perimeter:a.perimeter,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:RectangleRoi",finding:n,findingSites:t||[]}}}]),e}();le.toolType="RectangleRoi",le.utilityToolType="RectangleRoi",le.TID300Representation=ce,le.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var n=I(e.split(":"),2),t=n[0],r=n[1];return t===L&&r===le.toolType},k.registerTool(le);var de=r.hC.orientation,fe=de.rotateDirectionCosinesInPlane,ge=de.flipImageOrientationPatient,pe=de.flipMatrix2D,he=de.rotateMatrix902D,me=r.hC.datasetToBlob,Se=r.hC.BitArray,Ie=r.hC.DicomMessage,ve=r.hC.DicomMetaDictionary,ye=r.oq.Normalizer,Te=r.U7.Segmentation,Ce={generateSegmentation:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{includeSliceSpacing:!0},r=n.toolState,a=n.segments,o=e[0],i={x:o.columns,y:o.rows,z:e.length};if(i.xy=i.x*i.y,!De(u,a))throw new Error("No segments to export!");for(var s=o.imageId.includes("?frame"),u=function(e,n,t){var r=[];if(n){var a=e[0].data.byteArray.buffer,o=Ie.readFile(a),i=ve.naturalizeDataset(o.dict);i._meta=ve.namifyDataset(o.meta),r.push(i)}else for(var s=0;s<e.length;s++){var u=e[s].data.byteArray.buffer,c=Ie.readFile(u),l=ve.naturalizeDataset(c.dict);l._meta=ve.namifyDataset(c.meta),r.push(l)}var d=ye.normalizeToDataset(r);return new Te([d],t)}(e,s,t),c=function(e,n,t){for(var r=[],a=[],o=0;o<t.length;o++)t[o]&&(r.push(o),a.push([]));for(var i=0;i<n.length;i++)for(var s=e[n[i].imageId],u=0;u<r.length;u++){var c=r[u];s&&s.brush&&s.brush.data&&s.brush.data[c]&&s.brush.data[c].pixelData&&a[u].push(i)}return{referencedFramesPerSegment:a,segmentIndicies:r}}(r,e,a),l=c.referencedFramesPerSegment,d=c.segmentIndicies,f=0,g=0;g<l.length;g++)f+=l[g].length;u.setNumberOfFrames(f);for(var p=0;p<d.length;p++){var h=d[p],m=l[p],S=m.map((function(e){return e+1})),I=a[h];u.addSegment(I,Re(h,m,r,e,i),S)}return u.bitPackPixelData(),me(u.dataset)},generateToolState:function(e,n,t){var a=Ie.readFile(n),i=ve.naturalizeDataset(a.dict);i._meta=ve.namifyDataset(a.meta);var s=ye.normalizeToDataset([i]),u=t.get("imagePlaneModule",e[0]);u||console.warn("Insufficient metadata, imagePlaneModule missing.");for(var c=function(e){var n=[];n[0]=e,n[1]=ge.h(e),n[2]=ge.v(e);var t=fe(e,Math.PI/2);return n[3]=t,n[4]=ge.h(t),n[5]=ge.v(t),n[6]=fe(e,Math.PI),n[7]=fe(e,1.5*Math.PI),n}(Array.isArray(u.rowCosines)?[].concat(v(u.rowCosines),v(u.columnCosines)):[u.rowCosines.x,u.rowCosines.y,u.rowCosines.z,u.columnCosines.x,u.columnCosines.y,u.columnCosines.z]),l=s.SharedFunctionalGroupsSequence,d=l.PlaneOrientationSequence?l.PlaneOrientationSequence.ImageOrientationPatient:void 0,f=s.Columns*s.Rows,g=function(e){var n=[],t=e.SegmentSequence;if(Array.isArray(t))for(var r=0;r<t.length;r++)n.push(t[r]);else n.push(t);return{seriesInstanceUid:e.ReferencedSeriesSequence.SeriesInstanceUID,data:n}}(s),p=function(e){var n=e.SegmentationType;if("BINARY"===n)return Se.unpack(e.PixelData);var t=new Uint8Array(e.PixelData),a=e.MaximumFractionalValue,o=void 0===t.find((function(e){return 0!==e&&e!==a}));if(!o)return void r.cM.warn("This is a fractional segmentation, which is not currently supported.");return r.cM.warn("This segmentation object is actually binary... processing as such."),t}(s),h=s.PerFrameFunctionalGroupsSequence,m={},S=!0,I=0;I<h.length;I++){var y=h[I],T=d||y.PlaneOrientationSequence.ImageOrientationPatient,C=be(o()(new Uint8Array(p.buffer,I*f,f),[s.Rows,s.Columns]),T,c);if(!C){console.warn("This segmentation object is not in-plane with the source data. Bailing out of IO. It'd be better to render this with vtkjs. "),S=!1;break}var R=y.SegmentIdentificationSequence.ReferencedSegmentNumber-1;Oe(m,Ee(l.DerivationImageSequence&&l.DerivationImageSequence.SourceImageSequence?l.DerivationImageSequence.SourceImageSequence[I]:y.DerivationImageSequence.SourceImageSequence,e,t),R,C)}if(!S)return;return{toolState:m,segMetadata:g}}};function Re(e,n,t,r,a){for(var o=new Uint8Array(a.xy*n.length),i=0,s=0;s<n.length;s++)for(var u=t[r[n[s]].imageId].brush.data[e].pixelData,c=0;c<u.length;c++)o[i]=u[c],i++;return o}function De(e,n){for(var t=0,r=0;r<n.length;r++)n[r]&&t++;return t}function Oe(e,n,t,r){e[n]?e[n].brush?e[n].brush.data||(e[n].brush.data=[]):(e[n].brush={},e[n].brush.data=[]):(e[n]={},e[n].brush={},e[n].brush.data=[]),e[n].brush.data[t]={};var a=e[n].brush.data[t];a.pixelData=new Uint8Array(r.data.length);for(var o=a.pixelData,i=0;i<o.length;i++)r.data[i]?o[i]=1:o[i]=0}function Ee(e,n,t){var r=e.ReferencedSOPInstanceUID,a=e.ReferencedFrameNumber;return a?function(e,n,t,r){var a=t.find((function(t){var a=r.get("sopCommonModule",t);if(a){var o=Number(t.split("frame=")[1]);return a.sopInstanceUID===e&&o===n-1}}));return a}(r,a,n,t):function(e,n,t){return n.find((function(n){var r=t.get("sopCommonModule",n);if(r)return r.sopInstanceUID===e}))}(r,n,t)}function be(e,n,t){return Me(n,t[0])?e:Me(n,t[1])?pe.v(e):Me(n,t[2])?pe.h(e):Me(n,t[3])?he(e):Me(n,t[4])?pe.h(he(e)):Me(n,t[5])?pe.v(he(e)):Me(n,t[6])?he(he(e)):Me(n,t[7])?he(he(he(e))):void 0}var we,xe=1e-5;function Me(e,n){return Math.abs(e[0]-n[0])<xe&&Math.abs(e[1]-n[1])<xe&&Math.abs(e[2]-n[2])<xe&&Math.abs(e[3]-n[3])<xe&&Math.abs(e[4]-n[4])<xe&&Math.abs(e[5]-n[5])<xe}!function(e){e.SEGMENTATION_LOAD_PROGRESS="CORNERSTONE_ADAPTER_SEGMENTATION_LOAD_PROGRESS"}(we||(we={}));var Ne=we,Pe=r.hC.orientation,Ae=Pe.rotateDirectionCosinesInPlane,Ue=Pe.flipImageOrientationPatient,qe=Pe.flipMatrix2D,Ve=Pe.rotateMatrix902D,ke=Pe.nearlyEqual,Le=r.aT.datasetToDict,Fe=r.aT.BitArray,_e=r.aT.DicomMessage,Ge=r.aT.DicomMetaDictionary,Be=r.oq.Normalizer,je=r.U7.Segmentation,Ye=r.hC.compression,ze=Ye.encode,He=Ye.decode,$e={includeSliceSpacing:!0,rleEncode:!1};function We(e,n){for(var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object.assign({},$e,t),a=Array.isArray(n)?n:[n],o=0,i=[],s=function(){for(var e=a[c],n=e.labelmaps2D,t=e.metadata,r=[],s=1;s<t.length;s++)t[s]&&(r[s]=[]);for(var u=function(e){var t=n[e];n[e]&&t.segmentsOnLabelmap.forEach((function(n){0!==n&&(r[n].push(e),o++)}))},l=0;l<n.length;l++)u(l);i[c]=r},c=0;c<a.length;c++)s();e.setNumberOfFrames(o);for(var l=0;l<a.length;l++)for(var d=i[l],f=a[l],g=f.metadata,p=1;p<d.length;p++){var h=d[p];if(h){var m=h.map((function(e){return e+1})),S=g[p],I=Xe(f,h);e.addSegmentFromLabelmap(S,I,p,m)}}if(r.rleEncode){var v=ze(e.dataset.PixelData,o,e.dataset.Rows,e.dataset.Columns);e.assignToDataset({BitsAllocated:"8",BitsStored:"8",HighBit:"7",SegmentationType:"FRACTIONAL",SegmentationFractionalType:"PROBABILITY",MaximumFractionalValue:"255"}),e.dataset._meta.TransferSyntaxUID={Value:["1.2.840.10008.1.2.5"],vr:"UI"},e.dataset._vrMap.PixelData="OB",e.dataset.PixelData=v}else e.bitPackPixelData();var y=u.lW.from(Le(e.dataset).write());return new Blob([y],{type:"application/dicom"})}function Xe(e,n){for(var t=e.labelmaps2D,r=[],a=0;a<n.length;a++){var o=n[a];r.push(t[o].pixelData)}return r}function Je(){var e;return e=f().mark((function e(n,t,r,a){var o,i,s,u,c,l,d,g,p,h,m,S,I,y,T,C,R,D,O,E,b,w,x,M,N,P,A,U,q,V,k,L,F,_;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=a.skipOverlapping,i=void 0!==o&&o,s=a.tolerance,u=void 0===s?.001:s,c=a.TypedArrayConstructor,l=void 0===c?Uint8Array:c,d=a.maxBytesPerChunk,g=void 0===d?199e6:d,p=a.eventTarget,h=a.triggerEvent,m=_e.readFile(t),(S=Ge.naturalizeDataset(m.dict))._meta=Ge.namifyDataset(m.meta),I=Be.normalizeToDataset([S]),y=r.get("imagePlaneModule",n[0]),T=r.get("generalSeriesModule",n[0]),C=T.seriesInstanceUID,y||console.warn("Insufficient metadata, imagePlaneModule missing."),R=Array.isArray(y.rowCosines)?[].concat(v(y.rowCosines),v(y.columnCosines)):[y.rowCosines.x,y.rowCosines.y,y.rowCosines.z,y.columnCosines.x,y.columnCosines.y,y.columnCosines.z],D=an(R),O=I.Columns*I.Rows,E=un(I,C),"1.2.840.10008.1.2.5"!==I._meta.TransferSyntaxUID.Value[0]){e.next=23;break}if(x=Array.isArray(I.PixelData)?I.PixelData:[I.PixelData],b=He(x,I.Rows,I.Columns),1!==I.BitsStored){e.next=20;break}return console.warn("No implementation for rle + bitbacking."),e.abrupt("return");case 20:w=[b],e.next=26;break;case 23:if(w=rn(I,{maxBytesPerChunk:g})){e.next=26;break}throw new Error("Fractional segmentations are not yet supported");case 26:M=tn(I,D,[y.rows,y.columns,n.length],u),N=n.reduce((function(e,n){return e[r.get("generalImageModule",n).sopInstanceUid]=n,e}),{}),P=!1,i||(P=Qe(w,I,n,D,r,u,l,N)),e.t0=M,e.next="Planar"===e.t0?33:"Perpendicular"===e.t0?35:"Oblique"===e.t0?36:37;break;case 33:return A=P?Ze:nn,e.abrupt("break",37);case 35:throw new Error("Segmentations orthogonal to the acquisition plane of the source data are not yet supported.");case 36:throw new Error("Segmentations oblique to the acquisition plane of the source data are not yet supported.");case 37:return(U=[])[0]=[],q=[],V=O*n.length*l.BYTES_PER_ELEMENT,(k=[])[0]=new ArrayBuffer(V),L=n.reduce((function(e,n,t){return e.indices[n]=t,e.metadata[n]=r.get("instance",n),e}),{indices:{},metadata:{}}),F=new Map,e.next=47,A(q,U,k,w,I,n,D,r,u,l,F,N,L,p,h);case 47:return _=new Map,F.forEach((function(e,n){var t=ln(e,I),r=t.xAcc,a=t.yAcc,o=t.zAcc,i=t.count;_.set(n,{x:Math.floor(r/i),y:Math.floor(a/i),z:Math.floor(o/i)})})),e.abrupt("return",{labelmapBufferArray:k,segMetadata:E,segmentsOnFrame:q,segmentsOnFrameArray:U,centroids:_});case 50:case"end":return e.stop()}}),e)})),Je=function(){var n=this,t=arguments;return new Promise((function(r,a){var o=e.apply(n,t);function i(e){g(o,r,a,i,s,"next",e)}function s(e){g(o,r,a,i,s,"throw",e)}i(void 0)}))},Je.apply(this,arguments)}function Ke(e,n,t,r,a,o){var i=void 0;if(!e)return i;var s=e.FrameOfReferenceUID,u=e.PerFrameFunctionalGroupsSequence,c=e.SourceImageSequence,l=e.ReferencedSeriesSequence;if(!u||0===u.length)return i;var d=u[n];if(!d)return i;var f=void 0;if(c&&0!==c.length)f=c[n];else if(d.DerivationImageSequence){var g=d.DerivationImageSequence;Array.isArray(g)&&(g=0!==g.length?g[0]:void 0),g&&(f=g.SourceImageSequence,Array.isArray(f)&&(f=0!==f.length?f[0]:void 0))}(f&&(i=function(e,n){var t=e.ReferencedSOPInstanceUID,r=e.ReferencedFrameNumber;return r?function(e,n,t){var r=t[e];if(!r)return;var a=Number(r.split("frame=")[1]);return a===n-1?r:void 0}(t,r,n):n[t]}(f,o)),void 0===i&&l)&&(i=function(e,n,t,r,a,o){if(void 0===e||void 0===t.PlanePositionSequence||void 0===t.PlanePositionSequence[0]||void 0===t.PlanePositionSequence[0].ImagePositionPatient)return;for(var i=0;i<r.length;++i){var s=a.get("instance",r[i]);if(void 0!==s&&void 0!==s.ImagePositionPatient&&s.FrameOfReferenceUID===n&&s.SeriesInstanceUID===e&&sn(t.PlanePositionSequence[0].ImagePositionPatient,s.ImagePositionPatient,o))return r[i]}}((Array.isArray(l)?l[0]:l).SeriesInstanceUID,s,d,t,r,a));return i}function Qe(e,n,t,r,a,i,s,u){var c=n.SharedFunctionalGroupsSequence,l=n.PerFrameFunctionalGroupsSequence,d=n.SegmentSequence,f=n.Rows,g=n.Columns;if(d.length<2)return!1;for(var p=c.PlaneOrientationSequence?c.PlaneOrientationSequence.ImageOrientationPatient:void 0,h=g*f,m=l.length,S=new Map,v=function(){if(void 0===en(n,y))return console.warn("Could not retrieve the segment index for frame segment "+y+", skipping this frame."),"continue";var e=Ke(n,y,t,a,i,u);if(!e)return console.warn("Image not present in stack, can't import frame : "+y+"."),"continue";var r=t.findIndex((function(n){return n===e}));if(S.has(r)){var o=S.get(r);o.includes(y)||(o.push(y),S.set(r,o))}else S.set(r,[y])},y=0;y<m;++y)v();var T,R=C(S.entries());try{for(R.s();!(T=R.n()).done;)for(var D=I(T.value,2)[1],O=new s(h).fill(0),E=0;E<D.length;++E){var b=D[E],w=l[b],x=p||w.PlaneOrientationSequence.ImageOrientationPatient,M=cn(e,b*h,h),N=on(o()(M,[f,g]),x,r,i);if(N){for(var P=N.data,A=0,U=P.length;A<U;++A)if(0!==P[A]&&(O[A]++,O[A]>1))return!0}else console.warn("Individual SEG frames are out of plane with respect to the first SEG frame, this is not yet supported, skipping this frame.")}}catch(e){R.e(e)}finally{R.f()}return!1}function Ze(e,n,t,r,a,i,u,c,l,d,f,g){for(var p=a.SharedFunctionalGroupsSequence,h=a.PerFrameFunctionalGroupsSequence,m=a.Rows,S=a.Columns,I=p.PlaneOrientationSequence?p.PlaneOrientationSequence.ImageOrientationPatient:void 0,v=S*m,y=v*i.length*d.BYTES_PER_ELEMENT,T=1,C=0,R=t[C].slice(0),D=s()(n[C]),O=a.SegmentSequence.length,E=1;E<=O;++E){for(var b=function(f){var p=h[f],O=en(a,f);if(void 0===O)throw new Error("Could not retrieve the segment index. Aborting segmentation loading.");if(O!==E)return w=f,"continue";var b=I||p.PlaneOrientationSequence.ImageOrientationPatient,x=cn(r,f*v,v),M=on(o()(x,[m,S]),b,u,l);if(!M)throw new Error("Individual SEG frames are out of plane with respect to the first SEG frame. This is not yet supported. Aborting segmentation loading.");var N=Ke(a,f,i,c,l,g);if(!N)return console.warn("Image not present in stack, can't import frame : "+f+"."),w=f,"continue";var P=c.get("instance",N);if(m!==P.Rows||S!==P.Columns)throw new Error("Individual SEG frames have different geometry dimensions (Rows and Columns) respect to the source image reference frame. This is not yet supported. Aborting segmentation loading. ");for(var A=i.findIndex((function(e){return e===N})),U=v*A*d.BYTES_PER_ELEMENT,q=new d(R,U,v),V=M.data,k=!1,L=0,F=M.data.length;L<F;++L)if(V[L]){if(0!==q[L]){++C>=T&&(t[C]=new ArrayBuffer(y),n[C]=[],T++),R=t[C].slice(0),D=s()(n[C]),f=0;break}q[L]=O,k=!0}k&&(D[A]||(D[A]=[]),D[A].push(O),e[A]||(e[A]=[]),e[A].push(O)),w=f},w=0,x=h.length;w<x;++w)b(w);t[C]=R.slice(0),n[C]=s()(D),R=t[C=0].slice(0),D=s()(n[C])}}var en=function(e,n){var t=e.PerFrameFunctionalGroupsSequence,r=e.SharedFunctionalGroupsSequence,a=t[n];return a&&a.SegmentIdentificationSequence?a.SegmentIdentificationSequence.ReferencedSegmentNumber:r.SegmentIdentificationSequence?r.SegmentIdentificationSequence.ReferencedSegmentNumber:void 0};function nn(e,n,t,r,a,i,s,u,c,l,d,f,g,p,h){var m=a.SharedFunctionalGroupsSequence,S=a.PerFrameFunctionalGroupsSequence,I=a.Rows,v=a.Columns,y=m.PlaneOrientationSequence?m.PlaneOrientationSequence.ImageOrientationPatient:void 0,T=v*I,C=0,R=S.length,D=Math.ceil(R/10),O=h&&p;return new Promise((function(n){!function m(){for(var E=Math.min(C+D,R);C<E;++C){var b=S[C],w=y||b.PlaneOrientationSequence.ImageOrientationPatient,x=cn(r,C*T,T),M=on(o()(x,[I,v]),w,s,c);if(!M)throw new Error("Individual SEG frames are out of plane with respect to the first SEG frame. This is not yet supported. Aborting segmentation loading.");var N=en(a,C);if(void 0===N)throw new Error("Could not retrieve the segment index. Aborting segmentation loading.");d.has(N)||d.set(N,{});var P=Ke(a,C,i,u,c,f);if(P){var A=g.metadata[P];if(I!==A.Rows||v!==A.Columns)throw new Error("Individual SEG frames have different geometry dimensions (Rows and Columns) respect to the source image reference frame. This is not yet supported. Aborting segmentation loading. ");for(var U=g.indices[P],q=T*U*l.BYTES_PER_ELEMENT,V=new l(t[0],q,T),k=M.data,L=[],F=0,_=M.data.length;F<_;++F)if(k[F]){for(var G=F;G<_;++G)k[G]&&(V[G]=N,L.push(G));e[U]||(e[U]=[]),e[U].push(N);break}var B=d.get(N);B[U]=L,d.set(N,B)}else console.warn("Image not present in stack, can't import frame : "+C+".")}if(O){var j=Math.round(C/R*100);h(p,Ne.SEGMENTATION_LOAD_PROGRESS,{percentComplete:j})}C<R?setTimeout(m,0):n()}()}))}function tn(e,n,t,r){var a=e.SharedFunctionalGroupsSequence,o=e.PerFrameFunctionalGroupsSequence,i=a.PlaneOrientationSequence?a.PlaneOrientationSequence.ImageOrientationPatient:void 0,s=o[0],u=i||s.PlaneOrientationSequence.ImageOrientationPatient;return n.some((function(e){return sn(u,e,r)}))?"Planar":function(e,n,t){var r=Math.abs(e[0]*n[0]+e[1]*n[1]+e[2]*n[2]),a=Math.abs(e[3]*n[3]+e[4]*n[4]+e[5]*n[5]);return(r<t||Math.abs(r-1)<t)&&(a<t||Math.abs(a-1)<t)}(u,n[0],r)&&t.includes(e.Rows)&&t.includes(e.Columns)?"Perpendicular":"Oblique"}function rn(e,n){var t,a=e.SegmentationType;if(void 0===(t=Array.isArray(e.PixelData)?e.PixelData[0]:e.PixelData)&&r.cM.error("This segmentation pixeldata is undefined."),"BINARY"===a)return function(e,n){for(var t=new Uint8Array(e),r=[],a=8*n,o=Math.ceil(8*t.length/a),i=0;i<o;i++){var s=i*a,u=Math.min(s+a,8*t.length),c=Math.floor(s/8),l=Math.ceil(u/8),d=t.slice(c,l),f=Fe.unpack(d);r.push(f)}return r}(t,n.maxBytesPerChunk);var o=new Uint8Array(t),i=e.MaximumFractionalValue;return void 0===o.find((function(e){return 0!==e&&e!==i}))?(r.cM.warn("This segmentation object is actually binary... processing as such."),o):void 0}function an(e){var n=[];n[0]=e,n[1]=Ue.h(e),n[2]=Ue.v(e);var t=Ae(e,Math.PI/2);return n[3]=t,n[4]=Ue.h(t),n[5]=Ue.v(t),n[6]=Ae(e,Math.PI),n[7]=Ae(e,1.5*Math.PI),n}function on(e,n,t,r){return sn(n,t[0],r)?e:sn(n,t[1],r)?qe.v(e):sn(n,t[2],r)?qe.h(e):sn(n,t[3],r)?Ve(e):sn(n,t[4],r)?Ve(qe.h(e)):sn(n,t[5],r)?Ve(qe.v(e)):sn(n,t[6],r)?Ve(Ve(e)):sn(n,t[7],r)?Ve(Ve(Ve(e))):void 0}function sn(e,n,t){if(e.length!=n.length)return!1;for(var r=0;r<e.length;++r)if(!ke(e[r],n[r],t))return!1;return!0}function un(e,n){var t=e.SegmentSequence;return{seriesInstanceUid:n,data:Array.isArray(t)?[void 0].concat(v(t)):[void 0,t]}}function cn(e,n,t){var r=function(e,n,t){var r=e.reduce((function(e,n){return e+n.length}),0);if(n<0||n+t>r)throw new Error("Offset and length out of bounds");var a=0,o=n;for(;o>=e[a].length;)o-=e[a].length,a++;var i=a,s=o+t;for(;s>e[i].length;)s-=e[i].length,i++;return{start:{chunkIndex:a,offset:o},end:{chunkIndex:i,offset:s}}}(e,n,t);if(r.start.chunkIndex===r.end.chunkIndex)return new Uint8Array(e[r.start.chunkIndex].buffer,r.start.offset,t);for(var a=new Uint8Array(t),o=0,i=r.start.chunkIndex;i<=r.end.chunkIndex;i++){var s=i===r.start.chunkIndex?r.start.offset:0,u=i===r.end.chunkIndex?r.end.offset:e[i].length;a.set(new Uint8Array(e[i].buffer,s,u-s),o),o+=u-s}return a}function ln(e,n){for(var t=0,r=0,a=0,o=0,i=0,s=Object.entries(e);i<s.length;i++){var u=I(s[i],2),c=u[0],l=u[1],d=Number(c);if(l&&0!==l.length){var f,g=C(l);try{for(g.s();!(f=g.n()).done;){var p=f.value,h=Math.floor(p/n.Rows);t+=p%n.Rows,r+=h,a+=d,o++}}catch(e){g.e(e)}finally{g.f()}}}return{xAcc:t,yAcc:r,zAcc:a,count:o}}var dn={generateSegmentation:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e[0].imageId.includes("?frame");return We(function(e,n,t){var r=[];if(n){var a=e[0].data.byteArray.buffer,o=_e.readFile(a),i=Ge.naturalizeDataset(o.dict);i._meta=Ge.namifyDataset(o.meta),r.push(i)}else for(var s=0;s<e.length;s++){var u=e[s].data.byteArray.buffer,c=_e.readFile(u),l=Ge.naturalizeDataset(c.dict);l._meta=Ge.namifyDataset(c.meta),r.push(l)}var d=Be.normalizeToDataset(r);return new je([d],t)}(e,r,t),n,t)},generateToolState:function(e,n,t,r){return Je.apply(this,arguments)},fillSegmentation:We};var fn={Length:G,FreehandRoi:j,Bidirectional:H,EllipticalRoi:X,CircleRoi:Q,ArrowAnnotate:te,MeasurementReport:k,CobbAngle:oe,Angle:ue,RectangleRoi:le},gn={Segmentation:{generateSegmentation:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{includeSliceSpacing:!0},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(4===r)return dn.generateSegmentation(e,n,t);if(3===r)return Ce.generateSegmentation(e,n,t);console.warn("No generateSegmentation adapater for cornerstone version ".concat(r,", exiting."))},generateToolState:function(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4;if(4===o)return dn.generateToolState(e,n,t,r,a);if(3===o)return Ce.generateToolState(e,n,t);console.warn("No generateToolState adapater for cornerstone version ".concat(o,", exiting."))},fillSegmentation:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{includeSliceSpacing:!0},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(4===r)return dn.fillSegmentation(e,n,t);console.warn("No generateSegmentation adapater for cornerstone version ".concat(r,", exiting."))}}},pn=function(){return pn=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e},pn.apply(this,arguments)};function hn(e,n,t){if(t||2===arguments.length)for(var r,a=0,o=n.length;a<o;a++)!r&&a in n||(r||(r=Array.prototype.slice.call(n,0,a)),r[a]=n[a]);return e.concat(r||Array.prototype.slice.call(n))}var mn="Cornerstone3DTools@^0.1.0",Sn={CodingSchemeDesignator:"CORNERSTONEJS",codeValues:{CORNERSTONEFREETEXT:"CORNERSTONEFREETEXT"}},In=r.hC.TID1500,vn=r.hC.addAccessors,yn=r.U7.StructuredReport,Tn=r.oq.Normalizer,Cn=In.TID1500MeasurementReport,Rn=In.TID1501MeasurementGroup,Dn=r.aT.DicomMetaDictionary,On={CodingSchemeDesignator:"DCM",CodeValue:"121071"},En={CodingSchemeDesignator:"SCT",CodeValue:"363698007"},bn={CodingSchemeDesignator:"SRT",CodeValue:"G-C0E3"},wn=function(e,n,t){var r=e.ConceptNameCodeSequence;if(r){var a=r.CodingSchemeDesignator,o=r.CodeValue;return a==n.CodingSchemeDesignator&&o==n.CodeValue||t&&a==t.CodingSchemeDesignator&&o==t.CodeValue}};function xn(e,n,t,r){var a=n[e],o=Mn.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE[e];if(a&&a.data&&a.data.length&&o){var i=a.data.map((function(e){return function(e,n,t,r,a){var o=r.getTID300RepresentationArguments(e,a);return o.ReferencedSOPSequence=t,new r.TID300Representation(o)}(e,0,t,o,r)}));return new Rn(i)}}var Mn=function(){function e(){}return e.getCornerstoneLabelFromDefaultState=function(e){var n=e.findingSites,t=void 0===n?[]:n,r=e.finding,a=Sn.codeValues.CORNERSTONEFREETEXT,o=t.find((function(e){return e.CodeValue===a}));return o?o.CodeMeaning:r&&r.CodeValue===a?r.CodeMeaning:void 0},e.generateDatasetMeta=function(){var e=new Uint8Array(2);return e[1]=1,{FileMetaInformationVersion:{Value:[e.buffer],vr:"OB"},TransferSyntaxUID:{Value:["1.2.840.10008.1.2.1"],vr:"UI"},ImplementationClassUID:{Value:[Dn.uid()],vr:"UI"},ImplementationVersionName:{Value:["dcmjs"],vr:"SH"}}},e.getSetupMeasurementData=function(n,t,r,a){var o=n.ContentSequence,i=D(o),s=i.find((function(e){return wn(e,On)})),u=i.filter((function(e){return wn(e,En,bn)}))||[],c=i.find((function(e){return"NUM"===e.ValueType})),l=D(c.ContentSequence).find((function(e){return"SCOORD"===e.ValueType})),d=l.ContentSequence.ReferencedSOPSequence,f=d.ReferencedSOPInstanceUID,g=d.ReferencedFrameNumber,p=t[f],h=r.get("imagePlaneModule",p),m=s?vn(s.ConceptCodeSequence):void 0,S=u.map((function(e){return vn(e.ConceptCodeSequence)})),I={description:void 0,sopInstanceUid:f,annotation:{annotationUID:Dn.uid(),metadata:{toolName:a,referencedImageId:p,FrameOfReferenceUID:h.frameOfReferenceUID,label:""},data:void 0},finding:m,findingSites:S};return I.finding&&(I.description=I.finding.CodeMeaning),I.annotation.metadata.label=e.getCornerstoneLabelFromDefaultState(I),{defaultState:I,NUMGroup:c,SCOORDGroup:l,ReferencedSOPSequence:d,ReferencedSOPInstanceUID:f,ReferencedFrameNumber:g}},e.generateReport=function(n,t,r,a){var o=[],i={},s=[],u=e.generateDatasetMeta();Object.keys(n).forEach((function(a){var u=t.get("sopCommonModule",a),c=t.get("instance",a),l=u.sopInstanceUID,d=u.sopClassUID,f=c.SeriesInstanceUID;if(i[l]=f,!s.find((function(e){return e.SeriesInstanceUID===f}))){var g=e.generateDerivationSourceDataset(c);s.push(g)}var p=t.get("frameNumber",a),h=n[a],m=Object.keys(h),S={ReferencedSOPClassUID:d,ReferencedSOPInstanceUID:l,ReferencedFrameNumber:void 0};(c&&c.NumberOfFrames&&c.NumberOfFrames>1||Tn.isMultiframeSOPClassUID(d))&&(S.ReferencedFrameNumber=p);var I=[];m.forEach((function(e){var n=xn(e,h,S,r);n&&I.push(n)})),o=o.concat(I)}));var c=new Cn({TID1501MeasurementGroups:o},a),l=new yn(s,a),d=c.contentItem(s,pn(pn({},a),{sopInstanceUIDsToSeriesInstanceUIDMap:i}));return l.dataset=Object.assign(l.dataset,d),l.dataset._meta=u,l},e.generateToolState=function(n,t,r,a,o){if("1500"!==n.ContentTemplateSequence.TemplateIdentifier)throw new Error("This package can currently only interpret DICOM SR TID 1500");var i=D(n.ContentSequence).find(O("Imaging Measurements")),s=D(i.ContentSequence).filter(O("Measurement Group")),u={},c=e.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE,l=[];return Object.keys(c).forEach((function(e){l.push(c[e]),u[e]=[]})),s.forEach((function(e){var i;try{var s=D(e.ContentSequence).find((function(e){return"Tracking Identifier"===e.ConceptNameCodeSequence.CodeMeaning})).TextValue,c=(null===(i=null==o?void 0:o.getToolClass)||void 0===i?void 0:i.call(o,e,n,l))||l.find((function(e){return e.isValidCornerstoneTrackingIdentifier(s)}));if(c){var d=c.getMeasurementData(e,t,r,a);console.log("=== ".concat(c.toolType," ===")),console.log(d),u[c.toolType].push(d)}}catch(n){console.warn("Unable to generate tool state for",e,n)}})),u},e.registerTool=function(n){e.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE[n.utilityToolType]=n,e.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE[n.toolType]=n,e.MEASUREMENT_BY_TOOLTYPE[n.toolType]=n.utilityToolType},e.CORNERSTONE_3D_TAG=mn,e.MEASUREMENT_BY_TOOLTYPE={},e.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE={},e.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE={},e.generateDerivationSourceDataset=function(n){var t=e.generateDatasetMeta();return pn(pn({},n),{_meta:t,_vrMap:{PixelData:"OW"}})},e}(),Nn=r.hC.TID300.Point,Pn="ArrowAnnotate",An="".concat(mn,":").concat(Pn),Un=Sn.codeValues,qn=Sn.CodingSchemeDesignator,Vn=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(n,t,r,a){for(var o=Mn.getSetupMeasurementData(n,t,a,e.toolType),i=o.defaultState,s=o.SCOORDGroup,u=o.ReferencedFrameNumber,c=i.annotation.metadata.referencedImageId,l=i.annotation.metadata.label,d=s.GraphicData,f=[],g=0;g<d.length;g+=2){var p=r(c,[d[g],d[g+1]]);f.push(p)}if(1===f.length){var h=a.get("imagePixelModule",c),m=10,S=10;if(h)m=h.columns/10,S=h.rows/10;var I=r(c,[d[0]+m,d[1]+S]);f.push(I)}var v=i;return v.annotation.data={text:l,handles:{arrowFirst:!0,points:[f[0],f[1]],activeHandleIndex:0,textBox:{hasMoved:!1}},frameNumber:u},v}},{key:"getTID300RepresentationArguments",value:function(e,n){var t=e.data,r=e.metadata,a=e.finding,o=e.findingSites,i=r.referencedImageId;if(!i)throw new Error("ArrowAnnotate.getTID300RepresentationArguments: referencedImageId is not defined");var s=t.handles,u=s.points,c=n(i,s.arrowFirst?u[0]:u[1]),l={points:[{x:c[0],y:c[1]}],trackingIdentifierTextValue:An,findingSites:o||[]};return a&&a.CodeValue===Un.CORNERSTONEFREETEXT||(a={CodeValue:Un.CORNERSTONEFREETEXT,CodingSchemeDesignator:qn,CodeMeaning:t.text}),l.finding=a,l}}]),e}();Vn.toolType=Pn,Vn.utilityToolType=Pn,Vn.TID300Representation=Nn,Vn.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var n=I(e.split(":"),2),t=n[0],r=n[1];return t===mn&&r===Pn},Mn.registerTool(Vn);var kn=r.hC.TID300.Bidirectional,Ln="Bidirectional",Fn="".concat(mn,":").concat(Ln),_n=function(){function e(){}return e.getMeasurementData=function(n,t,r,a){var o,i=Mn.getSetupMeasurementData(n,t,a,e.toolType),s=i.defaultState,u=i.ReferencedFrameNumber,c=s.annotation.metadata.referencedImageId,l=n.ContentSequence,d=D(l).find((function(e){return"Long Axis"===e.ConceptNameCodeSequence.CodeMeaning})),f=D(d.ContentSequence).find((function(e){return"SCOORD"===e.ValueType})),g=D(l).find((function(e){return"Short Axis"===e.ConceptNameCodeSequence.CodeMeaning})),p=D(g.ContentSequence).find((function(e){return"SCOORD"===e.ValueType})),h=[];[f,p].forEach((function(e){for(var n=e.GraphicData,t=0;t<n.length;t+=2){var a=r(c,[n[t],n[t+1]]);h.push(a)}}));var m=s;return m.annotation.data={handles:{points:[h[0],h[1],h[2],h[3]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:(o={},o["imageId:".concat(c)]={length:d.MeasuredValueSequence.NumericValue,width:g.MeasuredValueSequence.NumericValue},o),frameNumber:u},m},e.getTID300RepresentationArguments=function(e,n){var t=e.data,r=e.finding,a=e.findingSites,o=e.metadata,i=t.cachedStats,s=void 0===i?{}:i,u=t.handles,c=o.referencedImageId;if(!c)throw new Error("Bidirectional.getTID300RepresentationArguments: referencedImageId is not defined");var l,d,f=s["imageId:".concat(c)]||{},g=f.length,p=f.width,h=u.points,m=[h[0],h[1]],S=[h[2],h[3]];Math.sqrt(Math.pow(m[0][0]-m[1][0],2)+Math.pow(m[0][1]-m[1][1],2)+Math.pow(m[0][2]-m[1][2],2))>Math.sqrt(Math.pow(S[0][0]-S[1][0],2)+Math.pow(S[0][1]-S[1][1],2)+Math.pow(S[0][2]-S[1][2],2))?(l=m,d=S):(l=S,d=m);var I=n(c,l[0]),v=n(c,l[1]),y=n(c,d[0]),T=n(c,d[1]);return{longAxis:{point1:{x:I[0],y:I[1]},point2:{x:v[0],y:v[1]}},shortAxis:{point1:{x:y[0],y:y[1]},point2:{x:T[0],y:T[1]}},longAxisLength:g,shortAxisLength:p,trackingIdentifierTextValue:Fn,finding:r,findingSites:a||[]}},e.toolType=Ln,e.utilityToolType=Ln,e.TID300Representation=kn,e.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var n=e.split(":"),t=n[0],r=n[1];return t===mn&&r===Ln},e}();Mn.registerTool(_n);var Gn=r.hC.TID300.CobbAngle,Bn="Angle",jn="".concat(mn,":").concat(Bn),Yn=function(){function e(){}return e.getMeasurementData=function(n,t,r,a){for(var o,i=Mn.getSetupMeasurementData(n,t,a,e.toolType),s=i.defaultState,u=i.NUMGroup,c=i.SCOORDGroup,l=i.ReferencedFrameNumber,d=s.annotation.metadata.referencedImageId,f=c.GraphicData,g=[],p=0;p<f.length;p+=2){var h=r(d,[f[p],f[p+1]]);g.push(h)}var m=s;return m.annotation.data={handles:{points:[g[0],g[1],g[3]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:(o={},o["imageId:".concat(d)]={angle:u?u.MeasuredValueSequence.NumericValue:null},o),frameNumber:l},m},e.getTID300RepresentationArguments=function(e,n){var t=e.data,r=e.finding,a=e.findingSites,o=e.metadata,i=t.cachedStats,s=void 0===i?{}:i,u=t.handles,c=o.referencedImageId;if(!c)throw new Error("Angle.getTID300RepresentationArguments: referencedImageId is not defined");var l=n(c,u.points[0]),d=n(c,u.points[1]),f=n(c,u.points[2]),g={x:l[0],y:l[1]},p={x:d[0],y:d[1]};return{point1:g,point2:p,point3:p,point4:{x:f[0],y:f[1]},rAngle:(s["imageId:".concat(c)]||{}).angle,trackingIdentifierTextValue:jn,finding:r,findingSites:a||[]}},e.toolType=Bn,e.utilityToolType=Bn,e.TID300Representation=Gn,e.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var n=e.split(":"),t=n[0],r=n[1];return t===mn&&r===Bn},e}();Mn.registerTool(Yn);var zn=r.hC.TID300.CobbAngle,Hn="CobbAngle",$n="".concat(mn,":").concat(Hn),Wn=function(){function e(){}return e.getMeasurementData=function(n,t,r,a){for(var o,i=Mn.getSetupMeasurementData(n,t,a,e.toolType),s=i.defaultState,u=i.NUMGroup,c=i.SCOORDGroup,l=i.ReferencedFrameNumber,d=s.annotation.metadata.referencedImageId,f=c.GraphicData,g=[],p=0;p<f.length;p+=2){var h=r(d,[f[p],f[p+1]]);g.push(h)}var m=s;return m.annotation.data={handles:{points:[g[0],g[1],g[2],g[3]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:(o={},o["imageId:".concat(d)]={angle:u?u.MeasuredValueSequence.NumericValue:null},o),frameNumber:l},m},e.getTID300RepresentationArguments=function(e,n){var t=e.data,r=e.finding,a=e.findingSites,o=e.metadata,i=t.cachedStats,s=void 0===i?{}:i,u=t.handles,c=o.referencedImageId;if(!c)throw new Error("CobbAngle.getTID300RepresentationArguments: referencedImageId is not defined");var l=n(c,u.points[0]),d=n(c,u.points[1]),f=n(c,u.points[2]),g=n(c,u.points[3]);return{point1:{x:l[0],y:l[1]},point2:{x:d[0],y:d[1]},point3:{x:f[0],y:f[1]},point4:{x:g[0],y:g[1]},rAngle:(s["imageId:".concat(c)]||{}).angle,trackingIdentifierTextValue:$n,finding:r,findingSites:a||[]}},e.toolType=Hn,e.utilityToolType=Hn,e.TID300Representation=zn,e.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var n=e.split(":"),t=n[0],r=n[1];return t===mn&&r===Hn},e}();function Xn(e){if(!e.includes(":"))return!1;var n=e.split(":"),t=n[0],r=n[1];return t===mn&&r.toLowerCase()===this.toolType.toLowerCase()}Mn.registerTool(Wn);var Jn=r.hC.TID300.Circle,Kn="CircleROI",Qn=function(){function e(){}return e.getMeasurementData=function(n,t,r,a){for(var o,i=Mn.getSetupMeasurementData(n,t,a,e.toolType),s=i.defaultState,u=i.NUMGroup,c=i.SCOORDGroup,l=i.ReferencedFrameNumber,d=s.annotation.metadata.referencedImageId,f=c.GraphicData,g=[],p=0;p<f.length;p+=2){var h=r(d,[f[p],f[p+1]]);g.push(h)}var m=s;return m.annotation.data={handles:{points:hn([],g,!0),activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:(o={},o["imageId:".concat(d)]={area:u?u.MeasuredValueSequence.NumericValue:0,radius:0,perimeter:0},o),frameNumber:l},m},e.getTID300RepresentationArguments=function(e,n){var t=e.data,r=e.finding,a=e.findingSites,o=e.metadata,i=t.cachedStats,s=void 0===i?{}:i,u=t.handles,c=o.referencedImageId;if(!c)throw new Error("CircleROI.getTID300RepresentationArguments: referencedImageId is not defined");var l=n(c,u.points[0]),d=n(c,u.points[1]),f=[];f.push({x:l[0],y:l[1]}),f.push({x:d[0],y:d[1]});var g=s["imageId:".concat(c)]||{},p=g.area,h=g.radius;return{area:p,perimeter:2*Math.PI*h,radius:h,points:f,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:r,findingSites:a||[]}},e.trackingIdentifierTextValue="".concat(mn,":").concat(Kn),e.toolType=Kn,e.utilityToolType=Kn,e.TID300Representation=Jn,e.isValidCornerstoneTrackingIdentifier=Xn,e}();Mn.registerTool(Qn);var Zn=r.hC.TID300.Ellipse,et="EllipticalROI",nt=1e-4,tt=function(){function e(){}return e.getMeasurementData=function(n,t,r,a){for(var o,i=Mn.getSetupMeasurementData(n,t,a,e.toolType),s=i.defaultState,u=i.NUMGroup,l=i.SCOORDGroup,d=i.ReferencedFrameNumber,f=s.annotation.metadata.referencedImageId,g=l.GraphicData,p=[],h=0;h<g.length;h+=2){var m=r(f,[g[h],g[h+1]]);p.push(m)}var S=c.R3.fromValues.apply(c.R3,p[0]),I=c.R3.fromValues.apply(c.R3,p[1]),v=c.R3.fromValues.apply(c.R3,p[2]),y=c.R3.fromValues.apply(c.R3,p[3]),T=c.R3.create();c.R3.sub(T,I,S),c.R3.normalize(T,T);var C=c.R3.create();c.R3.sub(C,y,v),c.R3.normalize(C,C);var R=a.get("imagePlaneModule",f);if(!R)throw new Error("imageId does not have imagePlaneModule metadata");var D=R.columnCosines,O=c.R3.fromValues(D[0],D[1],D[2]),E=c.R3.dot(O,T),b=c.R3.dot(O,C),w=Math.abs(E),x=Math.abs(b),M=[];Math.abs(w-1)<nt?M=[p[0],p[1],p[2],p[3]]:Math.abs(x-1)<nt?M=[p[2],p[3],p[0],p[1]]:console.warn("OBLIQUE ELLIPSE NOT YET SUPPORTED");var N=s;return N.annotation.data={handles:{points:hn([],M,!0),activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:(o={},o["imageId:".concat(f)]={area:u?u.MeasuredValueSequence.NumericValue:0},o),frameNumber:d},N},e.getTID300RepresentationArguments=function(e,n){var t,r,a,o,i=e.data,s=e.finding,u=e.findingSites,c=e.metadata,l=i.cachedStats,d=void 0===l?{}:l,f=i.handles,g=i.initialRotation||0,p=c.referencedImageId;if(!p)throw new Error("EllipticalROI.getTID300RepresentationArguments: referencedImageId is not defined");90==g||270==g?(r=n(p,f.points[2]),t=n(p,f.points[3]),a=n(p,f.points[0]),o=n(p,f.points[1])):(t=n(p,f.points[0]),r=n(p,f.points[1]),a=n(p,f.points[2]),o=n(p,f.points[3]));var h=[];return Math.abs(t[1]-r[1])>Math.abs(a[0]-o[0])?(h.push({x:t[0],y:t[1]}),h.push({x:r[0],y:r[1]}),h.push({x:a[0],y:a[1]}),h.push({x:o[0],y:o[1]})):(h.push({x:a[0],y:a[1]}),h.push({x:o[0],y:o[1]}),h.push({x:t[0],y:t[1]}),h.push({x:r[0],y:r[1]})),{area:(d["imageId:".concat(p)]||{}).area,points:h,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:s,findingSites:u||[]}},e.trackingIdentifierTextValue="".concat(mn,":").concat(et),e.toolType=et,e.utilityToolType=et,e.TID300Representation=Zn,e.isValidCornerstoneTrackingIdentifier=Xn,e}();Mn.registerTool(tt);var rt=r.hC.TID300.Polyline,at="RectangleROI",ot="".concat(mn,":").concat(at),it=function(){function e(){}return e.getMeasurementData=function(n,t,r,a){for(var o,i=Mn.getSetupMeasurementData(n,t,a,e.toolType),s=i.defaultState,u=i.NUMGroup,c=i.SCOORDGroup,l=i.ReferencedFrameNumber,d=s.annotation.metadata.referencedImageId,f=c.GraphicData,g=[],p=0;p<f.length;p+=2){var h=r(d,[f[p],f[p+1]]);g.push(h)}var m=s;return m.annotation.data={handles:{points:[g[0],g[1],g[3],g[2]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:(o={},o["imageId:".concat(d)]={area:u?u.MeasuredValueSequence.NumericValue:null},o),frameNumber:l},m},e.getTID300RepresentationArguments=function(e,n){var t=e.data,r=e.finding,a=e.findingSites,o=e.metadata,i=t.cachedStats,s=void 0===i?{}:i,u=t.handles,c=o.referencedImageId;if(!c)throw new Error("CobbAngle.getTID300RepresentationArguments: referencedImageId is not defined");var l=u.points.map((function(e){return n(c,e)})),d=s.area,f=s.perimeter;return{points:[l[0],l[1],l[3],l[2],l[0]],area:d,perimeter:f,trackingIdentifierTextValue:ot,finding:r,findingSites:a||[]}},e.toolType=at,e.utilityToolType=at,e.TID300Representation=rt,e.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var n=e.split(":"),t=n[0],r=n[1];return t===mn&&r===at},e}();Mn.registerTool(it);var st=r.hC.TID300.Length,ut="Length",ct="".concat(mn,":").concat(ut),lt=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(n,t,r,a){for(var o=Mn.getSetupMeasurementData(n,t,a,e.toolType),i=o.defaultState,s=o.NUMGroup,u=o.SCOORDGroup,c=o.ReferencedFrameNumber,l=i.annotation.metadata.referencedImageId,d=u.GraphicData,f=[],g=0;g<d.length;g+=2){var p=r(l,[d[g],d[g+1]]);f.push(p)}var h=i;return h.annotation.data={handles:{points:[f[0],f[1]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:S({},"imageId:".concat(l),{length:s?s.MeasuredValueSequence.NumericValue:0}),frameNumber:c},h}},{key:"getTID300RepresentationArguments",value:function(e,n){var t=e.data,r=e.finding,a=e.findingSites,o=e.metadata,i=t.cachedStats,s=void 0===i?{}:i,u=t.handles,c=o.referencedImageId;if(!c)throw new Error("Length.getTID300RepresentationArguments: referencedImageId is not defined");var l=n(c,u.points[0]),d=n(c,u.points[1]);return{point1:{x:l[0],y:l[1]},point2:{x:d[0],y:d[1]},distance:(s["imageId:".concat(c)]||{}).length,trackingIdentifierTextValue:ct,finding:r,findingSites:a||[]}}}]),e}();lt.toolType=ut,lt.utilityToolType=ut,lt.TID300Representation=st,lt.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var n=I(e.split(":"),2),t=n[0],r=n[1];return t===mn&&r===ut},Mn.registerTool(lt);var dt=r.hC.TID300.Polyline,ft="PlanarFreehandROI",gt="".concat(mn,":").concat(ft),pt=function(){function e(){}return e.getMeasurementData=function(n,t,r,a){for(var o=Mn.getSetupMeasurementData(n,t,a,e.toolType),i=o.defaultState,s=o.SCOORDGroup,u=o.ReferencedFrameNumber,l=i.annotation.metadata.referencedImageId,d=s.GraphicData,f=[],g=0;g<d.length;g+=2){var p=r(l,[d[g],d[g+1]]);f.push(p)}var h=!0;c.R3.distance(f[f.length-1],f[0])<1e-5&&(f.pop(),h=!1);var m=[];h&&m.push(f[0],f[f.length-1]);var S=i;return S.annotation.data={polyline:f,isOpenContour:h,handles:{points:m,activeHandleIndex:null,textBox:{hasMoved:!1}},frameNumber:u},S},e.getTID300RepresentationArguments=function(e,n){var t=e.data,r=e.finding,a=e.findingSites,o=e.metadata,i=t.isOpenContour,s=t.polyline,u=o.referencedImageId;if(!u)throw new Error("PlanarFreehandROI.getTID300RepresentationArguments: referencedImageId is not defined");var c=s.map((function(e){return n(u,e)}));if(!i){var l=c[0];c.push([l[0],l[1]])}return{points:c,area:0,perimeter:0,trackingIdentifierTextValue:gt,finding:r,findingSites:a||[]}},e.toolType=ft,e.utilityToolType=ft,e.TID300Representation=dt,e.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var n=e.split(":"),t=n[0],r=n[1];return t===mn&&r===ft},e}();Mn.registerTool(pt);var ht=r.hC.TID300.Point,mt="Probe",St="".concat(mn,":").concat(mt),It=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(n,t,r,a){for(var o=Mn.getSetupMeasurementData(n,t,a,e.toolType),i=o.defaultState,s=o.SCOORDGroup,u=o.ReferencedFrameNumber,c=i.annotation.metadata.referencedImageId,l=s.GraphicData,d=[],f=0;f<l.length;f+=2){var g=r(c,[l[f],l[f+1]]);d.push(g)}var p=i;return p.annotation.data={handles:{points:d,activeHandleIndex:null,textBox:{hasMoved:!1}},frameNumber:u},p}},{key:"getTID300RepresentationArguments",value:function(e,n){var t=e.data,r=e.metadata,a=e.finding,o=e.findingSites,i=r.referencedImageId;if(!i)throw new Error("Probe.getTID300RepresentationArguments: referencedImageId is not defined");return{points:t.handles.points.map((function(e){var t=n(i,e);return{x:t[0],y:t[1]}})),trackingIdentifierTextValue:St,findingSites:o||[],finding:a}}}]),e}();It.toolType=mt,It.utilityToolType=mt,It.TID300Representation=ht,It.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var n=I(e.split(":"),2),t=n[0],r=n[1];return t===mn&&r===mt},Mn.registerTool(It);r.oq.Normalizer,r.U7.Segmentation;gn.Segmentation.generateToolState;var vt={Bidirectional:_n,CobbAngle:Wn,Angle:Yn,Length:lt,CircleROI:Qn,EllipticalROI:tt,RectangleROI:it,ArrowAnnotate:Vn,Probe:It,PlanarFreehandROI:pt,MeasurementReport:Mn,CodeScheme:Sn,CORNERSTONE_3D_TAG:mn};r.aT.Colors,r.aT.BitArray;var yt={Cornerstone:fn,Cornerstone3D:vt}}}]);
//# sourceMappingURL=170.bundle.101a7759228261bd6c62.js.map